const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CVB99Otp.js","assets/index-oqw_ck6L.js","assets/index-z5JSsjg4.css","assets/index.es-sS-PFhIM.js","assets/functions-Bsik6ikd-Dr945oKc.js","assets/hooks-DzxriSVi.js","assets/floating-ui.dom-DJfcjnnZ.js","assets/index-w3KOZPBS.js"])))=>i.map(i=>d[i]);
import{_ as ai}from"./index-oqw_ck6L.js";import{P as mt,E as T,F as H,V as Je,S as me,R as Gt,g as Rs,a as F,b as Oe,G as Fs,D as A,c as We,d as Jt,e as ci,l as Ot,W as Qt,f as Xi,h as Et,i as x,T as On,A as En,j as Bt,k as Ne,C as Ws,m as qs,n as rt,s as Nn,o as ee,p as be,q as Rn,r as K,t as zs,u as er,v as _s,w as Zt,M as xn,x as $s,y as Us,z as js,B as Hs,H as Vs,I as Ks,J as Gs,K as Js,L as Qs,N as Zs,O as Ys,Q as Xs}from"./index.es-sS-PFhIM.js";import{c as eo,s as to,a as no,e as io,h as tr}from"./functions-Bsik6ikd-Dr945oKc.js";const ro=1024;let so=0;class ne{constructor(e,t){this.from=e,this.to=t}}class S{constructor(e={}){this.id=so++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=G.match(e)),t=>{let i=e(t);return i===void 0?null:[this,i]}}}S.closedBy=new S({deserialize:n=>n.split(" ")});S.openedBy=new S({deserialize:n=>n.split(" ")});S.group=new S({deserialize:n=>n.split(" ")});S.isolate=new S({deserialize:n=>{if(n&&n!="rtl"&&n!="ltr"&&n!="auto")throw new RangeError("Invalid value for isolate: "+n);return n||"auto"}});S.contextHash=new S({perNode:!0});S.lookAhead=new S({perNode:!0});S.mounted=new S({perNode:!0});class st{constructor(e,t,i){this.tree=e,this.overlay=t,this.parser=i}static get(e){return e&&e.props&&e.props[S.mounted.id]}}const oo=Object.create(null);class G{constructor(e,t,i,r=0){this.name=e,this.props=t,this.id=i,this.flags=r}static define(e){let t=e.props&&e.props.length?Object.create(null):oo,i=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),r=new G(e.name||"",t,e.id,i);if(e.props){for(let s of e.props)if(Array.isArray(s)||(s=s(r)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[s[0].id]=s[1]}}return r}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(S.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let i in e)for(let r of i.split(" "))t[r]=e[i];return i=>{for(let r=i.prop(S.group),s=-1;s<(r?r.length:0);s++){let o=t[s<0?i.name:r[s]];if(o)return o}}}}G.none=new G("",Object.create(null),0,8);class Fn{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let i of this.types){let r=null;for(let s of e){let o=s(i);o&&(r||(r=Object.assign({},i.props)),r[o[0].id]=o[1])}t.push(r?new G(i.name,r,i.id,i.flags):i)}return new Fn(t)}}const vt=new WeakMap,fi=new WeakMap;var R;(function(n){n[n.ExcludeBuffers=1]="ExcludeBuffers",n[n.IncludeAnonymous=2]="IncludeAnonymous",n[n.IgnoreMounts=4]="IgnoreMounts",n[n.IgnoreOverlays=8]="IgnoreOverlays"})(R||(R={}));class O{constructor(e,t,i,r,s){if(this.type=e,this.children=t,this.positions=i,this.length=r,this.props=null,s&&s.length){this.props=Object.create(null);for(let[o,l]of s)this.props[typeof o=="number"?o:o.id]=l}}toString(){let e=st.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let i of this.children){let r=i.toString();r&&(t&&(t+=","),t+=r)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new Nt(this.topNode,e)}cursorAt(e,t=0,i=0){let r=vt.get(this)||this.topNode,s=new Nt(r);return s.moveTo(e,t),vt.set(this,s._tree),s}get topNode(){return new j(this,0,0,null)}resolve(e,t=0){let i=ot(vt.get(this)||this.topNode,e,t,!1);return vt.set(this,i),i}resolveInner(e,t=0){let i=ot(fi.get(this)||this.topNode,e,t,!0);return fi.set(this,i),i}resolveStack(e,t=0){return co(this,e,t)}iterate(e){let{enter:t,leave:i,from:r=0,to:s=this.length}=e,o=e.mode||0,l=(o&R.IncludeAnonymous)>0;for(let a=this.cursor(o|R.IncludeAnonymous);;){let c=!1;if(a.from<=s&&a.to>=r&&(!l&&a.type.isAnonymous||t(a)!==!1)){if(a.firstChild())continue;c=!0}for(;c&&i&&(l||!a.type.isAnonymous)&&i(a),!a.nextSibling();){if(!a.parent())return;c=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:zn(G.none,this.children,this.positions,0,this.children.length,0,this.length,(t,i,r)=>new O(this.type,t,i,r,this.propValues),e.makeTree||((t,i,r)=>new O(G.none,t,i,r)))}static build(e){return fo(e)}}O.empty=new O(G.none,[],[],0);class Wn{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Wn(this.buffer,this.index)}}class Ce{constructor(e,t,i){this.buffer=e,this.length=t,this.set=i}get type(){return G.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],i=this.buffer[e+3],r=this.set.types[t],s=r.name;if(/\W/.test(s)&&!r.isError&&(s=JSON.stringify(s)),e+=4,i==e)return s;let o=[];for(;e<i;)o.push(this.childString(e)),e=this.buffer[e+3];return s+"("+o.join(",")+")"}findChild(e,t,i,r,s){let{buffer:o}=this,l=-1;for(let a=e;a!=t&&!(nr(s,r,o[a+1],o[a+2])&&(l=a,i>0));a=o[a+3]);return l}slice(e,t,i){let r=this.buffer,s=new Uint16Array(t-e),o=0;for(let l=e,a=0;l<t;){s[a++]=r[l++],s[a++]=r[l++]-i;let c=s[a++]=r[l++]-i;s[a++]=r[l++]-e,o=Math.max(o,c)}return new Ce(s,o,this.set)}}function nr(n,e,t,i){switch(n){case-2:return t<e;case-1:return i>=e&&t<e;case 0:return t<e&&i>e;case 1:return t<=e&&i>e;case 2:return i>e;case 4:return!0}}function ot(n,e,t,i){for(var r;n.from==n.to||(t<1?n.from>=e:n.from>e)||(t>-1?n.to<=e:n.to<e);){let o=!i&&n instanceof j&&n.index<0?null:n.parent;if(!o)return n;n=o}let s=i?0:R.IgnoreOverlays;if(i)for(let o=n,l=o.parent;l;o=l,l=o.parent)o instanceof j&&o.index<0&&((r=l.enter(e,t,s))===null||r===void 0?void 0:r.from)!=o.from&&(n=l);for(;;){let o=n.enter(e,t,s);if(!o)return n;n=o}}class ir{cursor(e=0){return new Nt(this,e)}getChild(e,t=null,i=null){let r=hi(this,e,t,i);return r.length?r[0]:null}getChildren(e,t=null,i=null){return hi(this,e,t,i)}resolve(e,t=0){return ot(this,e,t,!1)}resolveInner(e,t=0){return ot(this,e,t,!0)}matchContext(e){return kn(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),i=this;for(;t;){let r=t.lastChild;if(!r||r.to!=t.to)break;r.type.isError&&r.from==r.to?(i=t,t=r.prevSibling):t=r}return i}get node(){return this}get next(){return this.parent}}class j extends ir{constructor(e,t,i,r){super(),this._tree=e,this.from=t,this.index=i,this._parent=r}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,i,r,s=0){for(let o=this;;){for(let{children:l,positions:a}=o._tree,c=t>0?l.length:-1;e!=c;e+=t){let f=l[e],h=a[e]+o.from;if(nr(r,i,h,h+f.length)){if(f instanceof Ce){if(s&R.ExcludeBuffers)continue;let u=f.findChild(0,f.buffer.length,t,i-h,r);if(u>-1)return new ue(new lo(o,f,e,h),null,u)}else if(s&R.IncludeAnonymous||!f.type.isAnonymous||qn(f)){let u;if(!(s&R.IgnoreMounts)&&(u=st.get(f))&&!u.overlay)return new j(u.tree,h,e,o);let d=new j(f,h,e,o);return s&R.IncludeAnonymous||!d.type.isAnonymous?d:d.nextChild(t<0?f.children.length-1:0,t,i,r)}}}if(s&R.IncludeAnonymous||!o.type.isAnonymous||(o.index>=0?e=o.index+t:e=t<0?-1:o._parent._tree.children.length,o=o._parent,!o))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,i=0){let r;if(!(i&R.IgnoreOverlays)&&(r=st.get(this._tree))&&r.overlay){let s=e-this.from;for(let{from:o,to:l}of r.overlay)if((t>0?o<=s:o<s)&&(t<0?l>=s:l>s))return new j(r.tree,r.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,i)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function hi(n,e,t,i){let r=n.cursor(),s=[];if(!r.firstChild())return s;if(t!=null){for(let o=!1;!o;)if(o=r.type.is(t),!r.nextSibling())return s}for(;;){if(i!=null&&r.type.is(i))return s;if(r.type.is(e)&&s.push(r.node),!r.nextSibling())return i==null?s:[]}}function kn(n,e,t=e.length-1){for(let i=n;t>=0;i=i.parent){if(!i)return!1;if(!i.type.isAnonymous){if(e[t]&&e[t]!=i.name)return!1;t--}}return!0}class lo{constructor(e,t,i,r){this.parent=e,this.buffer=t,this.index=i,this.start=r}}class ue extends ir{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,i){super(),this.context=e,this._parent=t,this.index=i,this.type=e.buffer.set.types[e.buffer.buffer[i]]}child(e,t,i){let{buffer:r}=this.context,s=r.findChild(this.index+4,r.buffer[this.index+3],e,t-this.context.start,i);return s<0?null:new ue(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,i=0){if(i&R.ExcludeBuffers)return null;let{buffer:r}=this.context,s=r.findChild(this.index+4,r.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return s<0?null:new ue(this.context,this,s)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new ue(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new ue(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:i}=this.context,r=this.index+4,s=i.buffer[this.index+3];if(s>r){let o=i.buffer[this.index+1];e.push(i.slice(r,s,o)),t.push(0)}return new O(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function rr(n){if(!n.length)return null;let e=0,t=n[0];for(let s=1;s<n.length;s++){let o=n[s];(o.from>t.from||o.to<t.to)&&(t=o,e=s)}let i=t instanceof j&&t.index<0?null:t.parent,r=n.slice();return i?r[e]=i:r.splice(e,1),new ao(r,t)}class ao{constructor(e,t){this.heads=e,this.node=t}get next(){return rr(this.heads)}}function co(n,e,t){let i=n.resolveInner(e,t),r=null;for(let s=i instanceof j?i:i.context.parent;s;s=s.parent)if(s.index<0){let o=s.parent;(r||(r=[i])).push(o.resolve(e,t)),s=o}else{let o=st.get(s.tree);if(o&&o.overlay&&o.overlay[0].from<=e&&o.overlay[o.overlay.length-1].to>=e){let l=new j(o.tree,o.overlay[0].from+s.from,-1,s);(r||(r=[i])).push(ot(l,e,t,!1))}}return r?rr(r):i}class Nt{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof j)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let i=e._parent;i;i=i._parent)this.stack.unshift(i.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:i,buffer:r}=this.buffer;return this.type=t||r.set.types[r.buffer[e]],this.from=i+r.buffer[e+1],this.to=i+r.buffer[e+2],!0}yield(e){return e?e instanceof j?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,i){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,i,this.mode));let{buffer:r}=this.buffer,s=r.findChild(this.index+4,r.buffer[this.index+3],e,t-this.buffer.start,i);return s<0?!1:(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,i=this.mode){return this.buffer?i&R.ExcludeBuffers?!1:this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&R.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&R.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,i=this.stack.length-1;if(e<0){let r=i<0?0:this.stack[i]+4;if(this.index!=r)return this.yieldBuf(t.findChild(r,this.index,-1,0,4))}else{let r=t.buffer[this.index+3];if(r<(i<0?t.buffer.length:t.buffer[this.stack[i]+3]))return this.yieldBuf(r)}return i<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,i,{buffer:r}=this;if(r){if(e>0){if(this.index<r.buffer.buffer.length)return!1}else for(let s=0;s<this.index;s++)if(r.buffer.buffer[s+3]<this.index)return!1;({index:t,parent:i}=r)}else({index:t,_parent:i}=this._tree);for(;i;{index:t,_parent:i}=i)if(t>-1)for(let s=t+e,o=e<0?-1:i._tree.children.length;s!=o;s+=e){let l=i._tree.children[s];if(this.mode&R.IncludeAnonymous||l instanceof Ce||!l.type.isAnonymous||qn(l))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,i=0;if(e&&e.context==this.buffer)e:for(let r=this.index,s=this.stack.length;s>=0;){for(let o=e;o;o=o._parent)if(o.index==r){if(r==this.index)return o;t=o,i=s+1;break e}r=this.stack[--s]}for(let r=i;r<this.stack.length;r++)t=new ue(this.buffer,t,this.stack[r]);return this.bufferNode=new ue(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let i=0;;){let r=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){i++;continue}this.type.isAnonymous||(r=!0)}for(;;){if(r&&t&&t(this),r=this.type.isAnonymous,!i)return;if(this.nextSibling())break;this.parent(),i--,r=!0}}}matchContext(e){if(!this.buffer)return kn(this.node.parent,e);let{buffer:t}=this.buffer,{types:i}=t.set;for(let r=e.length-1,s=this.stack.length-1;r>=0;s--){if(s<0)return kn(this._tree,e,r);let o=i[t.buffer[this.stack[s]]];if(!o.isAnonymous){if(e[r]&&e[r]!=o.name)return!1;r--}}return!0}}function qn(n){return n.children.some(e=>e instanceof Ce||!e.type.isAnonymous||qn(e))}function fo(n){var e;let{buffer:t,nodeSet:i,maxBufferLength:r=ro,reused:s=[],minRepeatType:o=i.types.length}=n,l=Array.isArray(t)?new Wn(t,t.length):t,a=i.types,c=0,f=0;function h(k,D,b,q,L,z){let{id:M,start:w,end:E,size:N}=l,$=f,ke=c;for(;N<0;)if(l.next(),N==-1){let ye=s[M];b.push(ye),q.push(w-k);return}else if(N==-3){c=M;return}else if(N==-4){f=M;return}else throw new RangeError(`Unrecognized record size: ${N}`);let Xe=a[M],kt,Te,oi=w-k;if(E-w<=r&&(Te=C(l.pos-D,L))){let ye=new Uint16Array(Te.size-Te.skip),X=l.pos-Te.size,ae=ye.length;for(;l.pos>X;)ae=P(Te.start,ye,ae);kt=new Ce(ye,E-Te.start,i),oi=Te.start-k}else{let ye=l.pos-N;l.next();let X=[],ae=[],Ie=M>=o?M:-1,qe=0,wt=E;for(;l.pos>ye;)Ie>=0&&l.id==Ie&&l.size>=0?(l.end<=wt-r&&(y(X,ae,w,qe,l.end,wt,Ie,$,ke),qe=X.length,wt=l.end),l.next()):z>2500?u(w,ye,X,ae):h(w,ye,X,ae,Ie,z+1);if(Ie>=0&&qe>0&&qe<X.length&&y(X,ae,w,qe,w,wt,Ie,$,ke),X.reverse(),ae.reverse(),Ie>-1&&qe>0){let li=d(Xe,ke);kt=zn(Xe,X,ae,0,X.length,0,E-w,li,li)}else kt=g(Xe,X,ae,E-w,$-E,ke)}b.push(kt),q.push(oi)}function u(k,D,b,q){let L=[],z=0,M=-1;for(;l.pos>D;){let{id:w,start:E,end:N,size:$}=l;if($>4)l.next();else{if(M>-1&&E<M)break;M<0&&(M=N-r),L.push(w,E,N),z++,l.next()}}if(z){let w=new Uint16Array(z*4),E=L[L.length-2];for(let N=L.length-3,$=0;N>=0;N-=3)w[$++]=L[N],w[$++]=L[N+1]-E,w[$++]=L[N+2]-E,w[$++]=$;b.push(new Ce(w,L[2]-E,i)),q.push(E-k)}}function d(k,D){return(b,q,L)=>{let z=0,M=b.length-1,w,E;if(M>=0&&(w=b[M])instanceof O){if(!M&&w.type==k&&w.length==L)return w;(E=w.prop(S.lookAhead))&&(z=q[M]+w.length+E)}return g(k,b,q,L,z,D)}}function y(k,D,b,q,L,z,M,w,E){let N=[],$=[];for(;k.length>q;)N.push(k.pop()),$.push(D.pop()+b-L);k.push(g(i.types[M],N,$,z-L,w-z,E)),D.push(L-b)}function g(k,D,b,q,L,z,M){if(z){let w=[S.contextHash,z];M=M?[w].concat(M):[w]}if(L>25){let w=[S.lookAhead,L];M=M?[w].concat(M):[w]}return new O(k,D,b,q,M)}function C(k,D){let b=l.fork(),q=0,L=0,z=0,M=b.end-r,w={size:0,start:0,skip:0};e:for(let E=b.pos-k;b.pos>E;){let N=b.size;if(b.id==D&&N>=0){w.size=q,w.start=L,w.skip=z,z+=4,q+=4,b.next();continue}let $=b.pos-N;if(N<0||$<E||b.start<M)break;let ke=b.id>=o?4:0,Xe=b.start;for(b.next();b.pos>$;){if(b.size<0)if(b.size==-3)ke+=4;else break e;else b.id>=o&&(ke+=4);b.next()}L=Xe,q+=N,z+=ke}return(D<0||q==k)&&(w.size=q,w.start=L,w.skip=z),w.size>4?w:void 0}function P(k,D,b){let{id:q,start:L,end:z,size:M}=l;if(l.next(),M>=0&&q<o){let w=b;if(M>4){let E=l.pos-(M-4);for(;l.pos>E;)b=P(k,D,b)}D[--b]=w,D[--b]=z-k,D[--b]=L-k,D[--b]=q}else M==-3?c=q:M==-4&&(f=q);return b}let v=[],I=[];for(;l.pos>0;)h(n.start||0,n.bufferStart||0,v,I,-1,0);let W=(e=n.length)!==null&&e!==void 0?e:v.length?I[0]+v[0].length:0;return new O(a[n.topID],v.reverse(),I.reverse(),W)}const ui=new WeakMap;function Lt(n,e){if(!n.isAnonymous||e instanceof Ce||e.type!=n)return 1;let t=ui.get(e);if(t==null){t=1;for(let i of e.children){if(i.type!=n||!(i instanceof O)){t=1;break}t+=Lt(n,i)}ui.set(e,t)}return t}function zn(n,e,t,i,r,s,o,l,a){let c=0;for(let y=i;y<r;y++)c+=Lt(n,e[y]);let f=Math.ceil(c*1.5/8),h=[],u=[];function d(y,g,C,P,v){for(let I=C;I<P;){let W=I,k=g[I],D=Lt(n,y[I]);for(I++;I<P;I++){let b=Lt(n,y[I]);if(D+b>=f)break;D+=b}if(I==W+1){if(D>f){let b=y[W];d(b.children,b.positions,0,b.children.length,g[W]+v);continue}h.push(y[W])}else{let b=g[I-1]+y[I-1].length-k;h.push(zn(n,y,g,W,I,k,b,null,a))}u.push(k+v-s)}}return d(e,t,i,r,0),(l||a)(h,u,o)}class Sf{constructor(){this.map=new WeakMap}setBuffer(e,t,i){let r=this.map.get(e);r||this.map.set(e,r=new Map),r.set(t,i)}getBuffer(e,t){let i=this.map.get(e);return i&&i.get(t)}set(e,t){e instanceof ue?this.setBuffer(e.context.buffer,e.index,t):e instanceof j&&this.map.set(e.tree,t)}get(e){return e instanceof ue?this.getBuffer(e.context.buffer,e.index):e instanceof j?this.map.get(e.tree):void 0}cursorSet(e,t){e.buffer?this.setBuffer(e.buffer.buffer,e.index,t):this.map.set(e.tree,t)}cursorGet(e){return e.buffer?this.getBuffer(e.buffer.buffer,e.index):this.map.get(e.tree)}}class xe{constructor(e,t,i,r,s=!1,o=!1){this.from=e,this.to=t,this.tree=i,this.offset=r,this.open=(s?1:0)|(o?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],i=!1){let r=[new xe(0,e.length,e,0,!1,i)];for(let s of t)s.to>e.length&&r.push(s);return r}static applyChanges(e,t,i=128){if(!t.length)return e;let r=[],s=1,o=e.length?e[0]:null;for(let l=0,a=0,c=0;;l++){let f=l<t.length?t[l]:null,h=f?f.fromA:1e9;if(h-a>=i)for(;o&&o.from<h;){let u=o;if(a>=u.from||h<=u.to||c){let d=Math.max(u.from,a)-c,y=Math.min(u.to,h)-c;u=d>=y?null:new xe(d,y,u.tree,u.offset+c,l>0,!!f)}if(u&&r.push(u),o.to>h)break;o=s<e.length?e[s++]:null}if(!f)break;a=f.toA,c=f.toA-f.toB}return r}}class sr{startParse(e,t,i){return typeof e=="string"&&(e=new ho(e)),i=i?i.length?i.map(r=>new ne(r.from,r.to)):[new ne(0,0)]:[new ne(0,e.length)],this.createParse(e,t||[],i)}parse(e,t,i){let r=this.startParse(e,t,i);for(;;){let s=r.advance();if(s)return s}}}class ho{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}function Cf(n){return(e,t,i,r)=>new po(e,n,t,i,r)}class di{constructor(e,t,i,r,s){this.parser=e,this.parse=t,this.overlay=i,this.target=r,this.from=s}}function pi(n){if(!n.length||n.some(e=>e.from>=e.to))throw new RangeError("Invalid inner parse ranges given: "+JSON.stringify(n))}class uo{constructor(e,t,i,r,s,o,l){this.parser=e,this.predicate=t,this.mounts=i,this.index=r,this.start=s,this.target=o,this.prev=l,this.depth=0,this.ranges=[]}}const wn=new S({perNode:!0});class po{constructor(e,t,i,r,s){this.nest=t,this.input=i,this.fragments=r,this.ranges=s,this.inner=[],this.innerDone=0,this.baseTree=null,this.stoppedAt=null,this.baseParse=e}advance(){if(this.baseParse){let i=this.baseParse.advance();if(!i)return null;if(this.baseParse=null,this.baseTree=i,this.startInner(),this.stoppedAt!=null)for(let r of this.inner)r.parse.stopAt(this.stoppedAt)}if(this.innerDone==this.inner.length){let i=this.baseTree;return this.stoppedAt!=null&&(i=new O(i.type,i.children,i.positions,i.length,i.propValues.concat([[wn,this.stoppedAt]]))),i}let e=this.inner[this.innerDone],t=e.parse.advance();if(t){this.innerDone++;let i=Object.assign(Object.create(null),e.target.props);i[S.mounted.id]=new st(t,e.overlay,e.parser),e.target.props=i}return null}get parsedPos(){if(this.baseParse)return 0;let e=this.input.length;for(let t=this.innerDone;t<this.inner.length;t++)this.inner[t].from<e&&(e=Math.min(e,this.inner[t].parse.parsedPos));return e}stopAt(e){if(this.stoppedAt=e,this.baseParse)this.baseParse.stopAt(e);else for(let t=this.innerDone;t<this.inner.length;t++)this.inner[t].parse.stopAt(e)}startInner(){let e=new yo(this.fragments),t=null,i=null,r=new Nt(new j(this.baseTree,this.ranges[0].from,0,null),R.IncludeAnonymous|R.IgnoreMounts);e:for(let s,o;;){let l=!0,a;if(this.stoppedAt!=null&&r.from>=this.stoppedAt)l=!1;else if(e.hasNode(r)){if(t){let c=t.mounts.find(f=>f.frag.from<=r.from&&f.frag.to>=r.to&&f.mount.overlay);if(c)for(let f of c.mount.overlay){let h=f.from+c.pos,u=f.to+c.pos;h>=r.from&&u<=r.to&&!t.ranges.some(d=>d.from<u&&d.to>h)&&t.ranges.push({from:h,to:u})}}l=!1}else if(i&&(o=mo(i.ranges,r.from,r.to)))l=o!=2;else if(!r.type.isAnonymous&&(s=this.nest(r,this.input))&&(r.from<r.to||!s.overlay)){r.tree||go(r);let c=e.findMounts(r.from,s.parser);if(typeof s.overlay=="function")t=new uo(s.parser,s.overlay,c,this.inner.length,r.from,r.tree,t);else{let f=yi(this.ranges,s.overlay||(r.from<r.to?[new ne(r.from,r.to)]:[]));f.length&&pi(f),(f.length||!s.overlay)&&this.inner.push(new di(s.parser,f.length?s.parser.startParse(this.input,bi(c,f),f):s.parser.startParse(""),s.overlay?s.overlay.map(h=>new ne(h.from-r.from,h.to-r.from)):null,r.tree,f.length?f[0].from:r.from)),s.overlay?f.length&&(i={ranges:f,depth:0,prev:i}):l=!1}}else if(t&&(a=t.predicate(r))&&(a===!0&&(a=new ne(r.from,r.to)),a.from<a.to)){let c=t.ranges.length-1;c>=0&&t.ranges[c].to==a.from?t.ranges[c]={from:t.ranges[c].from,to:a.to}:t.ranges.push(a)}if(l&&r.firstChild())t&&t.depth++,i&&i.depth++;else for(;!r.nextSibling();){if(!r.parent())break e;if(t&&!--t.depth){let c=yi(this.ranges,t.ranges);c.length&&(pi(c),this.inner.splice(t.index,0,new di(t.parser,t.parser.startParse(this.input,bi(t.mounts,c),c),t.ranges.map(f=>new ne(f.from-t.start,f.to-t.start)),t.target,c[0].from))),t=t.prev}i&&!--i.depth&&(i=i.prev)}}}}function mo(n,e,t){for(let i of n){if(i.from>=t)break;if(i.to>e)return i.from<=e&&i.to>=t?2:1}return 0}function mi(n,e,t,i,r,s){if(e<t){let o=n.buffer[e+1];i.push(n.slice(e,t,o)),r.push(o-s)}}function go(n){let{node:e}=n,t=[],i=e.context.buffer;do t.push(n.index),n.parent();while(!n.tree);let r=n.tree,s=r.children.indexOf(i),o=r.children[s],l=o.buffer,a=[s];function c(f,h,u,d,y,g){let C=t[g],P=[],v=[];mi(o,f,C,P,v,d);let I=l[C+1],W=l[C+2];a.push(P.length);let k=g?c(C+4,l[C+3],o.set.types[l[C]],I,W-I,g-1):e.toTree();return P.push(k),v.push(I-d),mi(o,l[C+3],h,P,v,d),new O(u,P,v,y)}r.children[s]=c(0,l.length,G.none,0,o.length,t.length-1);for(let f of a){let h=n.tree.children[f],u=n.tree.positions[f];n.yield(new j(h,u+n.from,f,n._tree))}}class gi{constructor(e,t){this.offset=t,this.done=!1,this.cursor=e.cursor(R.IncludeAnonymous|R.IgnoreMounts)}moveTo(e){let{cursor:t}=this,i=e-this.offset;for(;!this.done&&t.from<i;)t.to>=e&&t.enter(i,1,R.IgnoreOverlays|R.ExcludeBuffers)||t.next(!1)||(this.done=!0)}hasNode(e){if(this.moveTo(e.from),!this.done&&this.cursor.from+this.offset==e.from&&this.cursor.tree)for(let t=this.cursor.tree;;){if(t==e.tree)return!0;if(t.children.length&&t.positions[0]==0&&t.children[0]instanceof O)t=t.children[0];else break}return!1}}class yo{constructor(e){var t;if(this.fragments=e,this.curTo=0,this.fragI=0,e.length){let i=this.curFrag=e[0];this.curTo=(t=i.tree.prop(wn))!==null&&t!==void 0?t:i.to,this.inner=new gi(i.tree,-i.offset)}else this.curFrag=this.inner=null}hasNode(e){for(;this.curFrag&&e.from>=this.curTo;)this.nextFrag();return this.curFrag&&this.curFrag.from<=e.from&&this.curTo>=e.to&&this.inner.hasNode(e)}nextFrag(){var e;if(this.fragI++,this.fragI==this.fragments.length)this.curFrag=this.inner=null;else{let t=this.curFrag=this.fragments[this.fragI];this.curTo=(e=t.tree.prop(wn))!==null&&e!==void 0?e:t.to,this.inner=new gi(t.tree,-t.offset)}}findMounts(e,t){var i;let r=[];if(this.inner){this.inner.cursor.moveTo(e,1);for(let s=this.inner.cursor.node;s;s=s.parent){let o=(i=s.tree)===null||i===void 0?void 0:i.prop(S.mounted);if(o&&o.parser==t)for(let l=this.fragI;l<this.fragments.length;l++){let a=this.fragments[l];if(a.from>=s.to)break;a.tree==this.curFrag.tree&&r.push({frag:a,pos:s.from-a.offset,mount:o})}}}return r}}function yi(n,e){let t=null,i=e;for(let r=1,s=0;r<n.length;r++){let o=n[r-1].to,l=n[r].from;for(;s<i.length;s++){let a=i[s];if(a.from>=l)break;a.to<=o||(t||(i=t=e.slice()),a.from<o?(t[s]=new ne(a.from,o),a.to>l&&t.splice(s+1,0,new ne(l,a.to))):a.to>l?t[s--]=new ne(l,a.to):t.splice(s--,1))}}return i}function bo(n,e,t,i){let r=0,s=0,o=!1,l=!1,a=-1e9,c=[];for(;;){let f=r==n.length?1e9:o?n[r].to:n[r].from,h=s==e.length?1e9:l?e[s].to:e[s].from;if(o!=l){let u=Math.max(a,t),d=Math.min(f,h,i);u<d&&c.push(new ne(u,d))}if(a=Math.min(f,h),a==1e9)break;f==a&&(o?(o=!1,r++):o=!0),h==a&&(l?(l=!1,s++):l=!0)}return c}function bi(n,e){let t=[];for(let{pos:i,mount:r,frag:s}of n){let o=i+(r.overlay?r.overlay[0].from:0),l=o+r.tree.length,a=Math.max(s.from,o),c=Math.min(s.to,l);if(r.overlay){let f=r.overlay.map(u=>new ne(u.from+i,u.to+i)),h=bo(e,f,a,c);for(let u=0,d=a;;u++){let y=u==h.length,g=y?c:h[u].from;if(g>d&&t.push(new xe(d,g,r.tree,-o,s.from>=d||s.openStart,s.to<=g||s.openEnd)),y)break;d=h[u].to}}else t.push(new xe(a,c,r.tree,-o,s.from>=o||s.openStart,s.to<=l||s.openEnd))}return t}let xo=0;class te{constructor(e,t,i,r){this.name=e,this.set=t,this.base=i,this.modified=r,this.id=xo++}toString(){let{name:e}=this;for(let t of this.modified)t.name&&(e=`${t.name}(${e})`);return e}static define(e,t){let i=typeof e=="string"?e:"?";if(e instanceof te&&(t=e),t!=null&&t.base)throw new Error("Can not derive from a modified tag");let r=new te(i,[],null,[]);if(r.set.push(r),t)for(let s of t.set)r.set.push(s);return r}static defineModifier(e){let t=new Rt(e);return i=>i.modified.indexOf(t)>-1?i:Rt.get(i.base||i,i.modified.concat(t).sort((r,s)=>r.id-s.id))}}let ko=0;class Rt{constructor(e){this.name=e,this.instances=[],this.id=ko++}static get(e,t){if(!t.length)return e;let i=t[0].instances.find(l=>l.base==e&&wo(t,l.modified));if(i)return i;let r=[],s=new te(e.name,r,e,t);for(let l of t)l.instances.push(s);let o=vo(t);for(let l of e.set)if(!l.modified.length)for(let a of o)r.push(Rt.get(l,a));return s}}function wo(n,e){return n.length==e.length&&n.every((t,i)=>t==e[i])}function vo(n){let e=[[]];for(let t=0;t<n.length;t++)for(let i=0,r=e.length;i<r;i++)e.push(e[i].concat(n[t]));return e.sort((t,i)=>i.length-t.length)}function So(n){let e=Object.create(null);for(let t in n){let i=n[t];Array.isArray(i)||(i=[i]);for(let r of t.split(" "))if(r){let s=[],o=2,l=r;for(let h=0;;){if(l=="..."&&h>0&&h+3==r.length){o=1;break}let u=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(l);if(!u)throw new RangeError("Invalid path: "+r);if(s.push(u[0]=="*"?"":u[0][0]=='"'?JSON.parse(u[0]):u[0]),h+=u[0].length,h==r.length)break;let d=r[h++];if(h==r.length&&d=="!"){o=0;break}if(d!="/")throw new RangeError("Invalid path: "+r);l=r.slice(h)}let a=s.length-1,c=s[a];if(!c)throw new RangeError("Invalid path: "+r);let f=new Ft(i,o,a>0?s.slice(0,a):null);e[c]=f.sort(e[c])}}return or.add(e)}const or=new S;class Ft{constructor(e,t,i,r){this.tags=e,this.mode=t,this.context=i,this.next=r}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}Ft.empty=new Ft([],2,null);function lr(n,e){let t=Object.create(null);for(let s of n)if(!Array.isArray(s.tag))t[s.tag.id]=s.class;else for(let o of s.tag)t[o.id]=s.class;let{scope:i,all:r=null}=e||{};return{style:s=>{let o=r;for(let l of s)for(let a of l.set){let c=t[a.id];if(c){o=o?o+" "+c:c;break}}return o},scope:i}}function Co(n,e){let t=null;for(let i of n){let r=i.style(e);r&&(t=t?t+" "+r:r)}return t}function Ao(n,e,t,i=0,r=n.length){let s=new Mo(i,Array.isArray(e)?e:[e],t);s.highlightRange(n.cursor(),i,r,"",s.highlighters),s.flush(r)}class Mo{constructor(e,t,i){this.at=e,this.highlighters=t,this.span=i,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,i,r,s){let{type:o,from:l,to:a}=e;if(l>=i||a<=t)return;o.isTop&&(s=this.highlighters.filter(d=>!d.scope||d.scope(o)));let c=r,f=To(e)||Ft.empty,h=Co(s,f.tags);if(h&&(c&&(c+=" "),c+=h,f.mode==1&&(r+=(r?" ":"")+h)),this.startSpan(Math.max(t,l),c),f.opaque)return;let u=e.tree&&e.tree.prop(S.mounted);if(u&&u.overlay){let d=e.node.enter(u.overlay[0].from+l,1),y=this.highlighters.filter(C=>!C.scope||C.scope(u.tree.type)),g=e.firstChild();for(let C=0,P=l;;C++){let v=C<u.overlay.length?u.overlay[C]:null,I=v?v.from+l:a,W=Math.max(t,P),k=Math.min(i,I);if(W<k&&g)for(;e.from<k&&(this.highlightRange(e,W,k,r,s),this.startSpan(Math.min(k,e.to),c),!(e.to>=I||!e.nextSibling())););if(!v||I>i)break;P=v.to+l,P>t&&(this.highlightRange(d.cursor(),Math.max(t,v.from+l),Math.min(i,P),"",y),this.startSpan(Math.min(i,P),c))}g&&e.parent()}else if(e.firstChild()){u&&(r="");do if(!(e.to<=t)){if(e.from>=i)break;this.highlightRange(e,t,i,r,s),this.startSpan(Math.min(i,e.to),c)}while(e.nextSibling());e.parent()}}}function To(n){let e=n.type.prop(or);for(;e&&e.context&&!n.matchContext(e.context);)e=e.next;return e||null}const p=te.define,St=p(),we=p(),xi=p(we),ki=p(we),ve=p(),Ct=p(ve),an=p(ve),he=p(),Pe=p(he),ce=p(),fe=p(),vn=p(),et=p(vn),At=p(),m={comment:St,lineComment:p(St),blockComment:p(St),docComment:p(St),name:we,variableName:p(we),typeName:xi,tagName:p(xi),propertyName:ki,attributeName:p(ki),className:p(we),labelName:p(we),namespace:p(we),macroName:p(we),literal:ve,string:Ct,docString:p(Ct),character:p(Ct),attributeValue:p(Ct),number:an,integer:p(an),float:p(an),bool:p(ve),regexp:p(ve),escape:p(ve),color:p(ve),url:p(ve),keyword:ce,self:p(ce),null:p(ce),atom:p(ce),unit:p(ce),modifier:p(ce),operatorKeyword:p(ce),controlKeyword:p(ce),definitionKeyword:p(ce),moduleKeyword:p(ce),operator:fe,derefOperator:p(fe),arithmeticOperator:p(fe),logicOperator:p(fe),bitwiseOperator:p(fe),compareOperator:p(fe),updateOperator:p(fe),definitionOperator:p(fe),typeOperator:p(fe),controlOperator:p(fe),punctuation:vn,separator:p(vn),bracket:et,angleBracket:p(et),squareBracket:p(et),paren:p(et),brace:p(et),content:he,heading:Pe,heading1:p(Pe),heading2:p(Pe),heading3:p(Pe),heading4:p(Pe),heading5:p(Pe),heading6:p(Pe),contentSeparator:p(he),list:p(he),quote:p(he),emphasis:p(he),strong:p(he),link:p(he),monospace:p(he),strikethrough:p(he),inserted:p(),deleted:p(),changed:p(),invalid:p(),meta:At,documentMeta:p(At),annotation:p(At),processingInstruction:p(At),definition:te.defineModifier("definition"),constant:te.defineModifier("constant"),function:te.defineModifier("function"),standard:te.defineModifier("standard"),local:te.defineModifier("local"),special:te.defineModifier("special")};for(let n in m){let e=m[n];e instanceof te&&(e.name=n)}lr([{tag:m.link,class:"tok-link"},{tag:m.heading,class:"tok-heading"},{tag:m.emphasis,class:"tok-emphasis"},{tag:m.strong,class:"tok-strong"},{tag:m.keyword,class:"tok-keyword"},{tag:m.atom,class:"tok-atom"},{tag:m.bool,class:"tok-bool"},{tag:m.url,class:"tok-url"},{tag:m.labelName,class:"tok-labelName"},{tag:m.inserted,class:"tok-inserted"},{tag:m.deleted,class:"tok-deleted"},{tag:m.literal,class:"tok-literal"},{tag:m.string,class:"tok-string"},{tag:m.number,class:"tok-number"},{tag:[m.regexp,m.escape,m.special(m.string)],class:"tok-string2"},{tag:m.variableName,class:"tok-variableName"},{tag:m.local(m.variableName),class:"tok-variableName tok-local"},{tag:m.definition(m.variableName),class:"tok-variableName tok-definition"},{tag:m.special(m.variableName),class:"tok-variableName2"},{tag:m.definition(m.propertyName),class:"tok-propertyName tok-definition"},{tag:m.typeName,class:"tok-typeName"},{tag:m.namespace,class:"tok-namespace"},{tag:m.className,class:"tok-className"},{tag:m.macroName,class:"tok-macroName"},{tag:m.propertyName,class:"tok-propertyName"},{tag:m.operator,class:"tok-operator"},{tag:m.comment,class:"tok-comment"},{tag:m.meta,class:"tok-meta"},{tag:m.invalid,class:"tok-invalid"},{tag:m.punctuation,class:"tok-punctuation"}]);var cn;const Be=new S;function ar(n){return H.define({combine:n?e=>e.concat(n):void 0})}const Io=new S;class ie{constructor(e,t,i=[],r=""){this.data=e,this.name=r,Oe.prototype.hasOwnProperty("tree")||Object.defineProperty(Oe.prototype,"tree",{get(){return U(this)}}),this.parser=t,this.extension=[Ae.of(this),Oe.languageData.of((s,o,l)=>{let a=wi(s,o,l),c=a.type.prop(Be);if(!c)return[];let f=s.facet(c),h=a.type.prop(Io);if(h){let u=a.resolve(o-a.from,l);for(let d of h)if(d.test(u,s)){let y=s.facet(d.facet);return d.type=="replace"?y:y.concat(f)}}return f})].concat(i)}isActiveAt(e,t,i=-1){return wi(e,t,i).type.prop(Be)==this.data}findRegions(e){let t=e.facet(Ae);if((t==null?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let i=[],r=(s,o)=>{if(s.prop(Be)==this.data){i.push({from:o,to:o+s.length});return}let l=s.prop(S.mounted);if(l){if(l.tree.prop(Be)==this.data){if(l.overlay)for(let a of l.overlay)i.push({from:a.from+o,to:a.to+o});else i.push({from:o,to:o+s.length});return}else if(l.overlay){let a=i.length;if(r(l.tree,l.overlay[0].from+o),i.length>a)return}}for(let a=0;a<s.children.length;a++){let c=s.children[a];c instanceof O&&r(c,s.positions[a]+o)}};return r(U(e),0),i}get allowsNesting(){return!0}}ie.setState=F.define();function wi(n,e,t){let i=n.facet(Ae),r=U(n).topNode;if(!i||i.allowsNesting)for(let s=r;s;s=s.enter(e,t,R.ExcludeBuffers))s.type.isTop&&(r=s);return r}class Sn extends ie{constructor(e,t,i){super(e,t,[],i),this.parser=t}static define(e){let t=ar(e.languageData);return new Sn(t,e.parser.configure({props:[Be.add(i=>i.isTop?t:void 0)]}),e.name)}configure(e,t){return new Sn(this.data,this.parser.configure(e),t||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function U(n){let e=n.field(ie.state,!1);return e?e.tree:O.empty}class Po{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let i=this.cursorPos-this.string.length;return e<i||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-i,t-i)}}let tt=null;class He{constructor(e,t,i=[],r,s,o,l,a){this.parser=e,this.state=t,this.fragments=i,this.tree=r,this.treeLen=s,this.viewport=o,this.skipped=l,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}static create(e,t,i){return new He(e,t,[],O.empty,0,i,[],null)}startParse(){return this.parser.startParse(new Po(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=O.empty&&this.isDone(t??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var i;if(typeof e=="number"){let r=Date.now()+e;e=()=>Date.now()>r}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let r=this.parse.advance();if(r)if(this.fragments=this.withoutTempSkipped(xe.addTree(r,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(i=this.parse.stoppedAt)!==null&&i!==void 0?i:this.state.doc.length,this.tree=r,this.parse=null,this.treeLen<(t??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(xe.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=tt;tt=this;try{return e()}finally{tt=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=vi(e,t.from,t.to);return e}changes(e,t){let{fragments:i,tree:r,treeLen:s,viewport:o,skipped:l}=this;if(this.takeTree(),!e.empty){let a=[];if(e.iterChangedRanges((c,f,h,u)=>a.push({fromA:c,toA:f,fromB:h,toB:u})),i=xe.applyChanges(i,a),r=O.empty,s=0,o={from:e.mapPos(o.from,-1),to:e.mapPos(o.to,1)},this.skipped.length){l=[];for(let c of this.skipped){let f=e.mapPos(c.from,1),h=e.mapPos(c.to,-1);f<h&&l.push({from:f,to:h})}}}return new He(this.parser,t,i,r,s,o,l,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let i=0;i<this.skipped.length;i++){let{from:r,to:s}=this.skipped[i];r<e.to&&s>e.from&&(this.fragments=vi(this.fragments,r,s),this.skipped.splice(i--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends sr{createParse(t,i,r){let s=r[0].from,o=r[r.length-1].to;return{parsedPos:s,advance(){let a=tt;if(a){for(let c of r)a.tempSkipped.push(c);e&&(a.scheduleOn=a.scheduleOn?Promise.all([a.scheduleOn,e]):e)}return this.parsedPos=o,new O(G.none,[],[],o-s)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return tt}}function vi(n,e,t){return xe.applyChanges(n,[{fromA:e,toA:t,fromB:e,toB:t}])}class Ve{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),i=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,i)||t.takeTree(),new Ve(t)}static init(e){let t=Math.min(3e3,e.doc.length),i=He.create(e.facet(Ae).parser,e,{from:0,to:t});return i.work(20,t)||i.takeTree(),new Ve(i)}}ie.state=me.define({create:Ve.init,update(n,e){for(let t of e.effects)if(t.is(ie.setState))return t.value;return e.startState.facet(Ae)!=e.state.facet(Ae)?Ve.init(e.state):n.apply(e)}});let cr=n=>{let e=setTimeout(()=>n(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(cr=n=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(n,{timeout:400})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});const fn=typeof navigator<"u"&&(!((cn=navigator.scheduling)===null||cn===void 0)&&cn.isInputPending)?()=>navigator.scheduling.isInputPending():null,Do=Je.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(ie.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(ie.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=cr(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:r}}=this.view,s=i.field(ie.state);if(s.tree==s.context.tree&&s.context.isDone(r+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,e&&!fn?Math.max(25,e.timeRemaining()-5):1e9),l=s.context.treeLen<r&&i.doc.length>r+1e3,a=s.context.work(()=>fn&&fn()||Date.now()>o,r+(l?0:1e5));this.chunkBudget-=Date.now()-t,(a||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:ie.setState.of(new Ve(s.context))})),this.chunkBudget>0&&!(a&&!l)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>Ot(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Ae=H.define({combine(n){return n.length?n[0]:null},enables:n=>[ie.state,Do,T.contentAttributes.compute([n],e=>{let t=e.facet(n);return t&&t.name?{"data-language":t.name}:{}})]});class Mf{constructor(e,t=[]){this.language=e,this.support=t,this.extension=[e,t]}}class fr{constructor(e,t,i,r,s,o=void 0){this.name=e,this.alias=t,this.extensions=i,this.filename=r,this.loadFunc=s,this.support=o,this.loading=null}load(){return this.loading||(this.loading=this.loadFunc().then(e=>this.support=e,e=>{throw this.loading=null,e}))}static of(e){let{load:t,support:i}=e;if(!t){if(!i)throw new RangeError("Must pass either 'load' or 'support' to LanguageDescription.of");t=()=>Promise.resolve(i)}return new fr(e.name,(e.alias||[]).concat(e.name).map(r=>r.toLowerCase()),e.extensions||[],e.filename,t,i)}static matchFilename(e,t){for(let r of e)if(r.filename&&r.filename.test(t))return r;let i=/\.([^.]+)$/.exec(t);if(i){for(let r of e)if(r.extensions.indexOf(i[1])>-1)return r}return null}static matchLanguageName(e,t,i=!0){t=t.toLowerCase();for(let r of e)if(r.alias.some(s=>s==t))return r;if(i)for(let r of e)for(let s of r.alias){let o=t.indexOf(s);if(o>-1&&(s.length>2||!/\w/.test(t[o-1])&&!/\w/.test(t[o+s.length])))return r}return null}}const Bo=H.define(),Yt=H.define({combine:n=>{if(!n.length)return"  ";let e=n[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(n[0]));return e}});function Re(n){let e=n.facet(Yt);return e.charCodeAt(0)==9?n.tabSize*e.length:e.length}function lt(n,e){let t="",i=n.tabSize,r=n.facet(Yt)[0];if(r=="	"){for(;e>=i;)t+="	",e-=i;r=" "}for(let s=0;s<e;s++)t+=r;return t}function _n(n,e){n instanceof Oe&&(n=new Xt(n));for(let i of n.state.facet(Bo)){let r=i(n,e);if(r!==void 0)return r}let t=U(n.state);return t.length>=e?Lo(n,t,e):null}class Xt{constructor(e,t={}){this.state=e,this.options=t,this.unit=Re(e)}lineAt(e,t=1){let i=this.state.doc.lineAt(e),{simulateBreak:r,simulateDoubleBreak:s}=this.options;return r!=null&&r>=i.from&&r<=i.to?s&&r==e?{text:"",from:e}:(t<0?r<e:r<=e)?{text:i.text.slice(r-i.from),from:r}:{text:i.text.slice(0,r-i.from),from:i.from}:i}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:i,from:r}=this.lineAt(e,t);return i.slice(e-r,Math.min(i.length,e+100-r))}column(e,t=1){let{text:i,from:r}=this.lineAt(e,t),s=this.countColumn(i,e-r),o=this.options.overrideIndentation?this.options.overrideIndentation(r):-1;return o>-1&&(s+=o-this.countColumn(i,i.search(/\S|$/))),s}countColumn(e,t=e.length){return Jt(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:i,from:r}=this.lineAt(e,t),s=this.options.overrideIndentation;if(s){let o=s(r);if(o>-1)return o}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const hr=new S;function Lo(n,e,t){let i=e.resolveStack(t),r=e.resolveInner(t,-1).resolve(t,0).enterUnfinishedNodesBefore(t);if(r!=i.node){let s=[];for(let o=r;o&&!(o.from==i.node.from&&o.type==i.node.type);o=o.parent)s.push(o);for(let o=s.length-1;o>=0;o--)i={node:s[o],next:i}}return ur(i,n,t)}function ur(n,e,t){for(let i=n;i;i=i.next){let r=Eo(i.node);if(r)return r($n.create(e,t,i))}return 0}function Oo(n){return n.pos==n.options.simulateBreak&&n.options.simulateDoubleBreak}function Eo(n){let e=n.type.prop(hr);if(e)return e;let t=n.firstChild,i;if(t&&(i=t.type.prop(S.closedBy))){let r=n.lastChild,s=r&&i.indexOf(r.name)>-1;return o=>dr(o,!0,1,void 0,s&&!Oo(o)?r.from:void 0)}return n.parent==null?No:null}function No(){return 0}class $n extends Xt{constructor(e,t,i){super(e.state,e.options),this.base=e,this.pos=t,this.context=i}get node(){return this.context.node}static create(e,t,i){return new $n(e,t,i)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let i=e.resolve(t.from);for(;i.parent&&i.parent.from==i.from;)i=i.parent;if(Ro(i,e))break;t=this.state.doc.lineAt(i.from)}return this.lineIndent(t.from)}continue(){return ur(this.context.next,this.base,this.pos)}}function Ro(n,e){for(let t=e;t;t=t.parent)if(n==t)return!0;return!1}function Fo(n){let e=n.node,t=e.childAfter(e.from),i=e.lastChild;if(!t)return null;let r=n.options.simulateBreak,s=n.state.doc.lineAt(t.from),o=r==null||r<=s.from?s.to:Math.min(s.to,r);for(let l=t.to;;){let a=e.childAfter(l);if(!a||a==i)return null;if(!a.type.isSkipped){if(a.from>=o)return null;let c=/^ */.exec(s.text.slice(t.to-s.from))[0].length;return{from:t.from,to:t.to+c}}l=a.to}}function Tf({closing:n,align:e=!0,units:t=1}){return i=>dr(i,e,t,n)}function dr(n,e,t,i,r){let s=n.textAfter,o=s.match(/^\s*/)[0].length,l=i&&s.slice(o,o+i.length)==i||r==n.pos+o,a=e?Fo(n):null;return a?l?n.column(a.from):n.column(a.to):n.baseIndent+(l?0:n.unit*t)}const If=n=>n.baseIndent;function Pf({except:n,units:e=1}={}){return t=>{let i=n&&n.test(t.textAfter);return t.baseIndent+(i?0:e*t.unit)}}const Wo=200;function qo(){return Oe.transactionFilter.of(n=>{if(!n.docChanged||!n.isUserEvent("input.type")&&!n.isUserEvent("input.complete"))return n;let e=n.startState.languageDataAt("indentOnInput",n.startState.selection.main.head);if(!e.length)return n;let t=n.newDoc,{head:i}=n.newSelection.main,r=t.lineAt(i);if(i>r.from+Wo)return n;let s=t.sliceString(r.from,i);if(!e.some(c=>c.test(s)))return n;let{state:o}=n,l=-1,a=[];for(let{head:c}of o.selection.ranges){let f=o.doc.lineAt(c);if(f.from==l)continue;l=f.from;let h=_n(o,f.from);if(h==null)continue;let u=/^\s*/.exec(f.text)[0],d=lt(o,h);u!=d&&a.push({from:f.from,to:f.from+u.length,insert:d})}return a.length?[n,{changes:a,sequential:!0}]:n})}const zo=H.define(),_o=new S;function Df(n){let e=n.firstChild,t=n.lastChild;return e&&e.to<t.from?{from:e.to,to:t.type.isError?n.to:t.from}:null}function $o(n,e,t){let i=U(n);if(i.length<t)return null;let r=i.resolveStack(t,1),s=null;for(let o=r;o;o=o.next){let l=o.node;if(l.to<=t||l.from>t)continue;if(s&&l.from<e)break;let a=l.type.prop(_o);if(a&&(l.to<i.length-50||i.length==n.doc.length||!Uo(l))){let c=a(l,n);c&&c.from<=t&&c.from>=e&&c.to>t&&(s=c)}}return s}function Uo(n){let e=n.lastChild;return e&&e.to==n.to&&e.type.isError}function Wt(n,e,t){for(let i of n.facet(zo)){let r=i(n,e,t);if(r)return r}return $o(n,e,t)}function pr(n,e){let t=e.mapPos(n.from,1),i=e.mapPos(n.to,-1);return t>=i?void 0:{from:t,to:i}}const en=F.define({map:pr}),gt=F.define({map:pr});function mr(n){let e=[];for(let{head:t}of n.state.selection.ranges)e.some(i=>i.from<=t&&i.to>=t)||e.push(n.lineBlockAt(t));return e}const Fe=me.define({create(){return A.none},update(n,e){n=n.map(e.changes);for(let t of e.effects)if(t.is(en)&&!jo(n,t.value.from,t.value.to)){let{preparePlaceholder:i}=e.state.facet(br),r=i?A.replace({widget:new Zo(i(e.state,t.value))}):Si;n=n.update({add:[r.range(t.value.from,t.value.to)]})}else t.is(gt)&&(n=n.update({filter:(i,r)=>t.value.from!=i||t.value.to!=r,filterFrom:t.value.from,filterTo:t.value.to}));if(e.selection){let t=!1,{head:i}=e.selection.main;n.between(i,i,(r,s)=>{r<i&&s>i&&(t=!0)}),t&&(n=n.update({filterFrom:i,filterTo:i,filter:(r,s)=>s<=i||r>=i}))}return n},provide:n=>T.decorations.from(n),toJSON(n,e){let t=[];return n.between(0,e.doc.length,(i,r)=>{t.push(i,r)}),t},fromJSON(n){if(!Array.isArray(n)||n.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let t=0;t<n.length;){let i=n[t++],r=n[t++];if(typeof i!="number"||typeof r!="number")throw new RangeError("Invalid JSON for fold state");e.push(Si.range(i,r))}return A.set(e,!0)}});function qt(n,e,t){var i;let r=null;return(i=n.field(Fe,!1))===null||i===void 0||i.between(e,t,(s,o)=>{(!r||r.from>s)&&(r={from:s,to:o})}),r}function jo(n,e,t){let i=!1;return n.between(e,e,(r,s)=>{r==e&&s==t&&(i=!0)}),i}function gr(n,e){return n.field(Fe,!1)?e:e.concat(F.appendConfig.of(xr()))}const Ho=n=>{for(let e of mr(n)){let t=Wt(n.state,e.from,e.to);if(t)return n.dispatch({effects:gr(n.state,[en.of(t),yr(n,t)])}),!0}return!1},Vo=n=>{if(!n.state.field(Fe,!1))return!1;let e=[];for(let t of mr(n)){let i=qt(n.state,t.from,t.to);i&&e.push(gt.of(i),yr(n,i,!1))}return e.length&&n.dispatch({effects:e}),e.length>0};function yr(n,e,t=!0){let i=n.state.doc.lineAt(e.from).number,r=n.state.doc.lineAt(e.to).number;return T.announce.of(`${n.state.phrase(t?"Folded lines":"Unfolded lines")} ${i} ${n.state.phrase("to")} ${r}.`)}const Ko=n=>{let{state:e}=n,t=[];for(let i=0;i<e.doc.length;){let r=n.lineBlockAt(i),s=Wt(e,r.from,r.to);s&&t.push(en.of(s)),i=(s?n.lineBlockAt(s.to):r).to+1}return t.length&&n.dispatch({effects:gr(n.state,t)}),!!t.length},Go=n=>{let e=n.state.field(Fe,!1);if(!e||!e.size)return!1;let t=[];return e.between(0,n.state.doc.length,(i,r)=>{t.push(gt.of({from:i,to:r}))}),n.dispatch({effects:t}),!0},Jo=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:Ho},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:Vo},{key:"Ctrl-Alt-[",run:Ko},{key:"Ctrl-Alt-]",run:Go}],Qo={placeholderDOM:null,preparePlaceholder:null,placeholderText:"…"},br=H.define({combine(n){return We(n,Qo)}});function xr(n){return[Fe,el]}function kr(n,e){let{state:t}=n,i=t.facet(br),r=o=>{let l=n.lineBlockAt(n.posAtDOM(o.target)),a=qt(n.state,l.from,l.to);a&&n.dispatch({effects:gt.of(a)}),o.preventDefault()};if(i.placeholderDOM)return i.placeholderDOM(n,r,e);let s=document.createElement("span");return s.textContent=i.placeholderText,s.setAttribute("aria-label",t.phrase("folded code")),s.title=t.phrase("unfold"),s.className="cm-foldPlaceholder",s.onclick=r,s}const Si=A.replace({widget:new class extends Qt{toDOM(n){return kr(n,null)}}});class Zo extends Qt{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return kr(e,this.value)}}const Yo={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class hn extends Fs{constructor(e,t){super(),this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}}function Xo(n={}){let e=Object.assign(Object.assign({},Yo),n),t=new hn(e,!0),i=new hn(e,!1),r=Je.fromClass(class{constructor(o){this.from=o.viewport.from,this.markers=this.buildMarkers(o)}update(o){(o.docChanged||o.viewportChanged||o.startState.facet(Ae)!=o.state.facet(Ae)||o.startState.field(Fe,!1)!=o.state.field(Fe,!1)||U(o.startState)!=U(o.state)||e.foldingChanged(o))&&(this.markers=this.buildMarkers(o.view))}buildMarkers(o){let l=new Gt;for(let a of o.viewportLineBlocks){let c=qt(o.state,a.from,a.to)?i:Wt(o.state,a.from,a.to)?t:null;c&&l.add(a.from,a.from,c)}return l.finish()}}),{domEventHandlers:s}=e;return[r,Rs({class:"cm-foldGutter",markers(o){var l;return((l=o.plugin(r))===null||l===void 0?void 0:l.markers)||Xi.empty},initialSpacer(){return new hn(e,!1)},domEventHandlers:Object.assign(Object.assign({},s),{click:(o,l,a)=>{if(s.click&&s.click(o,l,a))return!0;let c=qt(o.state,l.from,l.to);if(c)return o.dispatch({effects:gt.of(c)}),!0;let f=Wt(o.state,l.from,l.to);return f?(o.dispatch({effects:en.of(f)}),!0):!1}})}),xr()]}const el=T.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class tn{constructor(e,t){this.specs=e;let i;function r(l){let a=ci.newName();return(i||(i=Object.create(null)))["."+a]=l,a}const s=typeof t.all=="string"?t.all:t.all?r(t.all):void 0,o=t.scope;this.scope=o instanceof ie?l=>l.prop(Be)==o.data:o?l=>l==o:void 0,this.style=lr(e.map(l=>({tag:l.tag,class:l.class||r(Object.assign({},l,{tag:null}))})),{all:s}).style,this.module=i?new ci(i):null,this.themeType=t.themeType}static define(e,t){return new tn(e,t||{})}}const Cn=H.define(),wr=H.define({combine(n){return n.length?[n[0]]:null}});function un(n){let e=n.facet(Cn);return e.length?e:n.facet(wr)}function tl(n,e){let t=[il],i;return n instanceof tn&&(n.module&&t.push(T.styleModule.of(n.module)),i=n.themeType),e!=null&&e.fallback?t.push(wr.of(n)):i?t.push(Cn.computeN([T.darkTheme],r=>r.facet(T.darkTheme)==(i=="dark")?[n]:[])):t.push(Cn.of(n)),t}class nl{constructor(e){this.markCache=Object.create(null),this.tree=U(e.state),this.decorations=this.buildDeco(e,un(e.state)),this.decoratedTo=e.viewport.to}update(e){let t=U(e.state),i=un(e.state),r=i!=un(e.startState),{viewport:s}=e.view,o=e.changes.mapPos(this.decoratedTo,1);t.length<s.to&&!r&&t.type==this.tree.type&&o>=s.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=o):(t!=this.tree||e.viewportChanged||r)&&(this.tree=t,this.decorations=this.buildDeco(e.view,i),this.decoratedTo=s.to)}buildDeco(e,t){if(!t||!this.tree.length)return A.none;let i=new Gt;for(let{from:r,to:s}of e.visibleRanges)Ao(this.tree,t,(o,l,a)=>{i.add(o,l,this.markCache[a]||(this.markCache[a]=A.mark({class:a})))},r,s);return i.finish()}}const il=mt.high(Je.fromClass(nl,{decorations:n=>n.decorations})),rl=tn.define([{tag:m.meta,color:"#404740"},{tag:m.link,textDecoration:"underline"},{tag:m.heading,textDecoration:"underline",fontWeight:"bold"},{tag:m.emphasis,fontStyle:"italic"},{tag:m.strong,fontWeight:"bold"},{tag:m.strikethrough,textDecoration:"line-through"},{tag:m.keyword,color:"#708"},{tag:[m.atom,m.bool,m.url,m.contentSeparator,m.labelName],color:"#219"},{tag:[m.literal,m.inserted],color:"#164"},{tag:[m.string,m.deleted],color:"#a11"},{tag:[m.regexp,m.escape,m.special(m.string)],color:"#e40"},{tag:m.definition(m.variableName),color:"#00f"},{tag:m.local(m.variableName),color:"#30a"},{tag:[m.typeName,m.namespace],color:"#085"},{tag:m.className,color:"#167"},{tag:[m.special(m.variableName),m.macroName],color:"#256"},{tag:m.definition(m.propertyName),color:"#00c"},{tag:m.comment,color:"#940"},{tag:m.invalid,color:"#f00"}]),sl=T.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),vr=1e4,Sr="()[]{}",Cr=H.define({combine(n){return We(n,{afterCursor:!0,brackets:Sr,maxScanDistance:vr,renderMatch:al})}}),ol=A.mark({class:"cm-matchingBracket"}),ll=A.mark({class:"cm-nonmatchingBracket"});function al(n){let e=[],t=n.matched?ol:ll;return e.push(t.range(n.start.from,n.start.to)),n.end&&e.push(t.range(n.end.from,n.end.to)),e}const cl=me.define({create(){return A.none},update(n,e){if(!e.docChanged&&!e.selection)return n;let t=[],i=e.state.facet(Cr);for(let r of e.state.selection.ranges){if(!r.empty)continue;let s=de(e.state,r.head,-1,i)||r.head>0&&de(e.state,r.head-1,1,i)||i.afterCursor&&(de(e.state,r.head,1,i)||r.head<e.state.doc.length&&de(e.state,r.head+1,-1,i));s&&(t=t.concat(i.renderMatch(s,e.state)))}return A.set(t,!0)},provide:n=>T.decorations.from(n)}),fl=[cl,sl];function hl(n={}){return[Cr.of(n),fl]}const ul=new S;function An(n,e,t){let i=n.prop(e<0?S.openedBy:S.closedBy);if(i)return i;if(n.name.length==1){let r=t.indexOf(n.name);if(r>-1&&r%2==(e<0?1:0))return[t[r+e]]}return null}function Mn(n){let e=n.type.prop(ul);return e?e(n.node):n}function de(n,e,t,i={}){let r=i.maxScanDistance||vr,s=i.brackets||Sr,o=U(n),l=o.resolveInner(e,t);for(let a=l;a;a=a.parent){let c=An(a.type,t,s);if(c&&a.from<a.to){let f=Mn(a);if(f&&(t>0?e>=f.from&&e<f.to:e>f.from&&e<=f.to))return dl(n,e,t,a,f,c,s)}}return pl(n,e,t,o,l.type,r,s)}function dl(n,e,t,i,r,s,o){let l=i.parent,a={from:r.from,to:r.to},c=0,f=l==null?void 0:l.cursor();if(f&&(t<0?f.childBefore(i.from):f.childAfter(i.to)))do if(t<0?f.to<=i.from:f.from>=i.to){if(c==0&&s.indexOf(f.type.name)>-1&&f.from<f.to){let h=Mn(f);return{start:a,end:h?{from:h.from,to:h.to}:void 0,matched:!0}}else if(An(f.type,t,o))c++;else if(An(f.type,-t,o)){if(c==0){let h=Mn(f);return{start:a,end:h&&h.from<h.to?{from:h.from,to:h.to}:void 0,matched:!1}}c--}}while(t<0?f.prevSibling():f.nextSibling());return{start:a,matched:!1}}function pl(n,e,t,i,r,s,o){let l=t<0?n.sliceDoc(e-1,e):n.sliceDoc(e,e+1),a=o.indexOf(l);if(a<0||a%2==0!=t>0)return null;let c={from:t<0?e-1:e,to:t>0?e+1:e},f=n.doc.iterRange(e,t>0?n.doc.length:0),h=0;for(let u=0;!f.next().done&&u<=s;){let d=f.value;t<0&&(u+=d.length);let y=e+u*t;for(let g=t>0?0:d.length-1,C=t>0?d.length:-1;g!=C;g+=t){let P=o.indexOf(d[g]);if(!(P<0||i.resolveInner(y+g,1).type!=r))if(P%2==0==t>0)h++;else{if(h==1)return{start:c,end:{from:y+g,to:y+g+1},matched:P>>1==a>>1};h--}}t>0&&(u+=d.length)}return f.done?{start:c,matched:!1}:null}function Ci(n,e,t,i=0,r=0){e==null&&(e=n.search(/[^\s\u00a0]/),e==-1&&(e=n.length));let s=r;for(let o=i;o<e;o++)n.charCodeAt(o)==9?s+=t-s%t:s++;return s}class Ar{constructor(e,t,i,r){this.string=e,this.tabSize=t,this.indentUnit=i,this.overrideIndent=r,this.pos=0,this.start=0,this.lastColumnPos=0,this.lastColumnValue=0}eol(){return this.pos>=this.string.length}sol(){return this.pos==0}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(e){let t=this.string.charAt(this.pos),i;if(typeof e=="string"?i=t==e:i=t&&(e instanceof RegExp?e.test(t):e(t)),i)return++this.pos,t}eatWhile(e){let t=this.pos;for(;this.eat(e););return this.pos>t}eatSpace(){let e=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e}skipToEnd(){this.pos=this.string.length}skipTo(e){let t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0}backUp(e){this.pos-=e}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=Ci(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue}indentation(){var e;return(e=this.overrideIndent)!==null&&e!==void 0?e:Ci(this.string,null,this.tabSize)}match(e,t,i){if(typeof e=="string"){let r=o=>i?o.toLowerCase():o,s=this.string.substr(this.pos,e.length);return r(s)==r(e)?(t!==!1&&(this.pos+=e.length),!0):null}else{let r=this.string.slice(this.pos).match(e);return r&&r.index>0?null:(r&&t!==!1&&(this.pos+=r[0].length),r)}}current(){return this.string.slice(this.start,this.pos)}}function ml(n){return{name:n.name||"",token:n.token,blankLine:n.blankLine||(()=>{}),startState:n.startState||(()=>!0),copyState:n.copyState||gl,indent:n.indent||(()=>null),languageData:n.languageData||{},tokenTable:n.tokenTable||jn,mergeTokens:n.mergeTokens!==!1}}function gl(n){if(typeof n!="object")return n;let e={};for(let t in n){let i=n[t];e[t]=i instanceof Array?i.slice():i}return e}const Ai=new WeakMap;class Mr extends ie{constructor(e){let t=ar(e.languageData),i=ml(e),r,s=new class extends sr{createParse(o,l,a){return new bl(r,o,l,a)}};super(t,s,[],e.name),this.topNode=wl(t,this),r=this,this.streamParser=i,this.stateAfter=new S({perNode:!0}),this.tokenTable=e.tokenTable?new Dr(i.tokenTable):kl}static define(e){return new Mr(e)}getIndent(e){let t,{overrideIndentation:i}=e.options;i&&(t=Ai.get(e.state),t!=null&&t<e.pos-1e4&&(t=void 0));let r=Un(this,e.node.tree,e.node.from,e.node.from,t??e.pos),s,o;if(r?(o=r.state,s=r.pos+1):(o=this.streamParser.startState(e.unit),s=e.node.from),e.pos-s>1e4)return null;for(;s<e.pos;){let a=e.state.doc.lineAt(s),c=Math.min(e.pos,a.to);if(a.length){let f=i?i(a.from):-1,h=new Ar(a.text,e.state.tabSize,e.unit,f<0?void 0:f);for(;h.pos<c-a.from;)Ir(this.streamParser.token,h,o)}else this.streamParser.blankLine(o,e.unit);if(c==e.pos)break;s=a.to+1}let l=e.lineAt(e.pos);return i&&t==null&&Ai.set(e.state,l.from),this.streamParser.indent(o,/^\s*(.*)/.exec(l.text)[1],e)}get allowsNesting(){return!1}}function Un(n,e,t,i,r){let s=t>=i&&t+e.length<=r&&e.prop(n.stateAfter);if(s)return{state:n.streamParser.copyState(s),pos:t+e.length};for(let o=e.children.length-1;o>=0;o--){let l=e.children[o],a=t+e.positions[o],c=l instanceof O&&a<r&&Un(n,l,a,i,r);if(c)return c}return null}function Tr(n,e,t,i,r){if(r&&t<=0&&i>=e.length)return e;!r&&t==0&&e.type==n.topNode&&(r=!0);for(let s=e.children.length-1;s>=0;s--){let o=e.positions[s],l=e.children[s],a;if(o<i&&l instanceof O){if(!(a=Tr(n,l,t-o,i-o,r)))break;return r?new O(e.type,e.children.slice(0,s).concat(a),e.positions.slice(0,s+1),o+a.length):a}}return null}function yl(n,e,t,i,r){for(let s of e){let o=s.from+(s.openStart?25:0),l=s.to-(s.openEnd?25:0),a=o<=t&&l>t&&Un(n,s.tree,0-s.offset,t,l),c;if(a&&a.pos<=i&&(c=Tr(n,s.tree,t+s.offset,a.pos+s.offset,!1)))return{state:a.state,tree:c}}return{state:n.streamParser.startState(r?Re(r):4),tree:O.empty}}class bl{constructor(e,t,i,r){this.lang=e,this.input=t,this.fragments=i,this.ranges=r,this.stoppedAt=null,this.chunks=[],this.chunkPos=[],this.chunk=[],this.chunkReused=void 0,this.rangeIndex=0,this.to=r[r.length-1].to;let s=He.get(),o=r[0].from,{state:l,tree:a}=yl(e,i,o,this.to,s==null?void 0:s.state);this.state=l,this.parsedPos=this.chunkStart=o+a.length;for(let c=0;c<a.children.length;c++)this.chunks.push(a.children[c]),this.chunkPos.push(a.positions[c]);s&&this.parsedPos<s.viewport.from-1e5&&r.some(c=>c.from<=s.viewport.from&&c.to>=s.viewport.from)&&(this.state=this.lang.streamParser.startState(Re(s.state)),s.skipUntilInView(this.parsedPos,s.viewport.from),this.parsedPos=s.viewport.from),this.moveRangeIndex()}advance(){let e=He.get(),t=this.stoppedAt==null?this.to:Math.min(this.to,this.stoppedAt),i=Math.min(t,this.chunkStart+2048);for(e&&(i=Math.min(i,e.viewport.to));this.parsedPos<i;)this.parseLine(e);return this.chunkStart<this.parsedPos&&this.finishChunk(),this.parsedPos>=t?this.finish():e&&this.parsedPos>=e.viewport.to?(e.skipUntilInView(this.parsedPos,t),this.finish()):null}stopAt(e){this.stoppedAt=e}lineAfter(e){let t=this.input.chunk(e);if(this.input.lineChunks)t==`
`&&(t="");else{let i=t.indexOf(`
`);i>-1&&(t=t.slice(0,i))}return e+t.length<=this.to?t:t.slice(0,this.to-e)}nextLine(){let e=this.parsedPos,t=this.lineAfter(e),i=e+t.length;for(let r=this.rangeIndex;;){let s=this.ranges[r].to;if(s>=i||(t=t.slice(0,s-(i-t.length)),r++,r==this.ranges.length))break;let o=this.ranges[r].from,l=this.lineAfter(o);t+=l,i=o+l.length}return{line:t,end:i}}skipGapsTo(e,t,i){for(;;){let r=this.ranges[this.rangeIndex].to,s=e+t;if(i>0?r>s:r>=s)break;let o=this.ranges[++this.rangeIndex].from;t+=o-r}return t}moveRangeIndex(){for(;this.ranges[this.rangeIndex].to<this.parsedPos;)this.rangeIndex++}emitToken(e,t,i,r){let s=4;if(this.ranges.length>1){r=this.skipGapsTo(t,r,1),t+=r;let l=this.chunk.length;r=this.skipGapsTo(i,r,-1),i+=r,s+=this.chunk.length-l}let o=this.chunk.length-4;return this.lang.streamParser.mergeTokens&&s==4&&o>=0&&this.chunk[o]==e&&this.chunk[o+2]==t?this.chunk[o+2]=i:this.chunk.push(e,t,i,s),r}parseLine(e){let{line:t,end:i}=this.nextLine(),r=0,{streamParser:s}=this.lang,o=new Ar(t,e?e.state.tabSize:4,e?Re(e.state):2);if(o.eol())s.blankLine(this.state,o.indentUnit);else for(;!o.eol();){let l=Ir(s.token,o,this.state);if(l&&(r=this.emitToken(this.lang.tokenTable.resolve(l),this.parsedPos+o.start,this.parsedPos+o.pos,r)),o.start>1e4)break}this.parsedPos=i,this.moveRangeIndex(),this.parsedPos<this.to&&this.parsedPos++}finishChunk(){let e=O.build({buffer:this.chunk,start:this.chunkStart,length:this.parsedPos-this.chunkStart,nodeSet:xl,topID:0,maxBufferLength:2048,reused:this.chunkReused});e=new O(e.type,e.children,e.positions,e.length,[[this.lang.stateAfter,this.lang.streamParser.copyState(this.state)]]),this.chunks.push(e),this.chunkPos.push(this.chunkStart-this.ranges[0].from),this.chunk=[],this.chunkReused=void 0,this.chunkStart=this.parsedPos}finish(){return new O(this.lang.topNode,this.chunks,this.chunkPos,this.parsedPos-this.ranges[0].from).balance()}}function Ir(n,e,t){e.start=e.pos;for(let i=0;i<10;i++){let r=n(e,t);if(e.pos>e.start)return r}throw new Error("Stream parser failed to advance stream.")}const jn=Object.create(null),at=[G.none],xl=new Fn(at),Mi=[],Ti=Object.create(null),Pr=Object.create(null);for(let[n,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])Pr[n]=Br(jn,e);class Dr{constructor(e){this.extra=e,this.table=Object.assign(Object.create(null),Pr)}resolve(e){return e?this.table[e]||(this.table[e]=Br(this.extra,e)):0}}const kl=new Dr(jn);function dn(n,e){Mi.indexOf(n)>-1||(Mi.push(n),console.warn(e))}function Br(n,e){let t=[];for(let l of e.split(" ")){let a=[];for(let c of l.split(".")){let f=n[c]||m[c];f?typeof f=="function"?a.length?a=a.map(f):dn(c,`Modifier ${c} used at start of tag`):a.length?dn(c,`Tag ${c} used as modifier`):a=Array.isArray(f)?f:[f]:dn(c,`Unknown highlighting tag ${c}`)}for(let c of a)t.push(c)}if(!t.length)return 0;let i=e.replace(/ /g,"_"),r=i+" "+t.map(l=>l.id),s=Ti[r];if(s)return s.id;let o=Ti[r]=G.define({id:at.length,name:i,props:[So({[i]:t})]});return at.push(o),o.id}function wl(n,e){let t=G.define({id:at.length,name:"Document",props:[Be.add(()=>n),hr.add(()=>i=>e.getIndent(i))],top:!0});return at.push(t),t}Et.RTL,Et.LTR;const vl=n=>{let{state:e}=n,t=e.doc.lineAt(e.selection.main.from),i=Vn(n.state,t.from);return i.line?Sl(n):i.block?Al(n):!1};function Hn(n,e){return({state:t,dispatch:i})=>{if(t.readOnly)return!1;let r=n(e,t);return r?(i(t.update(r)),!0):!1}}const Sl=Hn(Il,0),Cl=Hn(Lr,0),Al=Hn((n,e)=>Lr(n,e,Tl(e)),0);function Vn(n,e){let t=n.languageDataAt("commentTokens",e,1);return t.length?t[0]:{}}const nt=50;function Ml(n,{open:e,close:t},i,r){let s=n.sliceDoc(i-nt,i),o=n.sliceDoc(r,r+nt),l=/\s*$/.exec(s)[0].length,a=/^\s*/.exec(o)[0].length,c=s.length-l;if(s.slice(c-e.length,c)==e&&o.slice(a,a+t.length)==t)return{open:{pos:i-l,margin:l&&1},close:{pos:r+a,margin:a&&1}};let f,h;r-i<=2*nt?f=h=n.sliceDoc(i,r):(f=n.sliceDoc(i,i+nt),h=n.sliceDoc(r-nt,r));let u=/^\s*/.exec(f)[0].length,d=/\s*$/.exec(h)[0].length,y=h.length-d-t.length;return f.slice(u,u+e.length)==e&&h.slice(y,y+t.length)==t?{open:{pos:i+u+e.length,margin:/\s/.test(f.charAt(u+e.length))?1:0},close:{pos:r-d-t.length,margin:/\s/.test(h.charAt(y-1))?1:0}}:null}function Tl(n){let e=[];for(let t of n.selection.ranges){let i=n.doc.lineAt(t.from),r=t.to<=i.to?i:n.doc.lineAt(t.to);r.from>i.from&&r.from==t.to&&(r=t.to==i.to+1?i:n.doc.lineAt(t.to-1));let s=e.length-1;s>=0&&e[s].to>i.from?e[s].to=r.to:e.push({from:i.from+/^\s*/.exec(i.text)[0].length,to:r.to})}return e}function Lr(n,e,t=e.selection.ranges){let i=t.map(s=>Vn(e,s.from).block);if(!i.every(s=>s))return null;let r=t.map((s,o)=>Ml(e,i[o],s.from,s.to));if(n!=2&&!r.every(s=>s))return{changes:e.changes(t.map((s,o)=>r[o]?[]:[{from:s.from,insert:i[o].open+" "},{from:s.to,insert:" "+i[o].close}]))};if(n!=1&&r.some(s=>s)){let s=[];for(let o=0,l;o<r.length;o++)if(l=r[o]){let a=i[o],{open:c,close:f}=l;s.push({from:c.pos-a.open.length,to:c.pos+c.margin},{from:f.pos-f.margin,to:f.pos+a.close.length})}return{changes:s}}return null}function Il(n,e,t=e.selection.ranges){let i=[],r=-1;for(let{from:s,to:o}of t){let l=i.length,a=1e9,c=Vn(e,s).line;if(c){for(let f=s;f<=o;){let h=e.doc.lineAt(f);if(h.from>r&&(s==o||o>h.from)){r=h.from;let u=/^\s*/.exec(h.text)[0].length,d=u==h.length,y=h.text.slice(u,u+c.length)==c?u:-1;u<h.text.length&&u<a&&(a=u),i.push({line:h,comment:y,token:c,indent:u,empty:d,single:!1})}f=h.to+1}if(a<1e9)for(let f=l;f<i.length;f++)i[f].indent<i[f].line.text.length&&(i[f].indent=a);i.length==l+1&&(i[l].single=!0)}}if(n!=2&&i.some(s=>s.comment<0&&(!s.empty||s.single))){let s=[];for(let{line:l,token:a,indent:c,empty:f,single:h}of i)(h||!f)&&s.push({from:l.from+c,insert:a+" "});let o=e.changes(s);return{changes:o,selection:e.selection.map(o,1)}}else if(n!=1&&i.some(s=>s.comment>=0)){let s=[];for(let{line:o,comment:l,token:a}of i)if(l>=0){let c=o.from+l,f=c+a.length;o.text[f-o.from]==" "&&f++,s.push({from:c,to:f})}return{changes:s}}return null}const Tn=En.define(),Pl=En.define(),Dl=H.define(),Or=H.define({combine(n){return We(n,{minDepth:100,newGroupDelay:500,joinToEvent:(e,t)=>t},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,t)=>(i,r)=>e(i,r)||t(i,r)})}}),Er=me.define({create(){return pe.empty},update(n,e){let t=e.state.facet(Or),i=e.annotation(Tn);if(i){let a=Q.fromTransaction(e,i.selection),c=i.side,f=c==0?n.undone:n.done;return a?f=zt(f,f.length,t.minDepth,a):f=Fr(f,e.startState.selection),new pe(c==0?i.rest:f,c==0?f:i.rest)}let r=e.annotation(Pl);if((r=="full"||r=="before")&&(n=n.isolate()),e.annotation(Bt.addToHistory)===!1)return e.changes.empty?n:n.addMapping(e.changes.desc);let s=Q.fromTransaction(e),o=e.annotation(Bt.time),l=e.annotation(Bt.userEvent);return s?n=n.addChanges(s,o,l,t,e):e.selection&&(n=n.addSelection(e.startState.selection,o,l,t.newGroupDelay)),(r=="full"||r=="after")&&(n=n.isolate()),n},toJSON(n){return{done:n.done.map(e=>e.toJSON()),undone:n.undone.map(e=>e.toJSON())}},fromJSON(n){return new pe(n.done.map(Q.fromJSON),n.undone.map(Q.fromJSON))}});function Bl(n={}){return[Er,Or.of(n),T.domEventHandlers({beforeinput(e,t){let i=e.inputType=="historyUndo"?Nr:e.inputType=="historyRedo"?In:null;return i?(e.preventDefault(),i(t)):!1}})]}function nn(n,e){return function({state:t,dispatch:i}){if(!e&&t.readOnly)return!1;let r=t.field(Er,!1);if(!r)return!1;let s=r.pop(n,t,e);return s?(i(s),!0):!1}}const Nr=nn(0,!1),In=nn(1,!1),Ll=nn(0,!0),Ol=nn(1,!0);class Q{constructor(e,t,i,r,s){this.changes=e,this.effects=t,this.mapped=i,this.startSelection=r,this.selectionsAfter=s}setSelAfter(e){return new Q(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,i;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(t=this.mapped)===null||t===void 0?void 0:t.toJSON(),startSelection:(i=this.startSelection)===null||i===void 0?void 0:i.toJSON(),selectionsAfter:this.selectionsAfter.map(r=>r.toJSON())}}static fromJSON(e){return new Q(e.changes&&Ws.fromJSON(e.changes),[],e.mapped&&qs.fromJSON(e.mapped),e.startSelection&&x.fromJSON(e.startSelection),e.selectionsAfter.map(x.fromJSON))}static fromTransaction(e,t){let i=re;for(let r of e.startState.facet(Dl)){let s=r(e);s.length&&(i=i.concat(s))}return!i.length&&e.changes.empty?null:new Q(e.changes.invert(e.startState.doc),i,void 0,t||e.startState.selection,re)}static selection(e){return new Q(void 0,re,void 0,void 0,e)}}function zt(n,e,t,i){let r=e+1>t+20?e-t-1:0,s=n.slice(r,e);return s.push(i),s}function El(n,e){let t=[],i=!1;return n.iterChangedRanges((r,s)=>t.push(r,s)),e.iterChangedRanges((r,s,o,l)=>{for(let a=0;a<t.length;){let c=t[a++],f=t[a++];l>=c&&o<=f&&(i=!0)}}),i}function Nl(n,e){return n.ranges.length==e.ranges.length&&n.ranges.filter((t,i)=>t.empty!=e.ranges[i].empty).length===0}function Rr(n,e){return n.length?e.length?n.concat(e):n:e}const re=[],Rl=200;function Fr(n,e){if(n.length){let t=n[n.length-1],i=t.selectionsAfter.slice(Math.max(0,t.selectionsAfter.length-Rl));return i.length&&i[i.length-1].eq(e)?n:(i.push(e),zt(n,n.length-1,1e9,t.setSelAfter(i)))}else return[Q.selection([e])]}function Fl(n){let e=n[n.length-1],t=n.slice();return t[n.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),t}function pn(n,e){if(!n.length)return n;let t=n.length,i=re;for(;t;){let r=Wl(n[t-1],e,i);if(r.changes&&!r.changes.empty||r.effects.length){let s=n.slice(0,t);return s[t-1]=r,s}else e=r.mapped,t--,i=r.selectionsAfter}return i.length?[Q.selection(i)]:re}function Wl(n,e,t){let i=Rr(n.selectionsAfter.length?n.selectionsAfter.map(l=>l.map(e)):re,t);if(!n.changes)return Q.selection(i);let r=n.changes.map(e),s=e.mapDesc(n.changes,!0),o=n.mapped?n.mapped.composeDesc(s):s;return new Q(r,F.mapEffects(n.effects,e),o,n.startSelection.map(s),i)}const ql=/^(input\.type|delete)($|\.)/;class pe{constructor(e,t,i=0,r=void 0){this.done=e,this.undone=t,this.prevTime=i,this.prevUserEvent=r}isolate(){return this.prevTime?new pe(this.done,this.undone):this}addChanges(e,t,i,r,s){let o=this.done,l=o[o.length-1];return l&&l.changes&&!l.changes.empty&&e.changes&&(!i||ql.test(i))&&(!l.selectionsAfter.length&&t-this.prevTime<r.newGroupDelay&&r.joinToEvent(s,El(l.changes,e.changes))||i=="input.type.compose")?o=zt(o,o.length-1,r.minDepth,new Q(e.changes.compose(l.changes),Rr(F.mapEffects(e.effects,l.changes),l.effects),l.mapped,l.startSelection,re)):o=zt(o,o.length,r.minDepth,e),new pe(o,re,t,i)}addSelection(e,t,i,r){let s=this.done.length?this.done[this.done.length-1].selectionsAfter:re;return s.length>0&&t-this.prevTime<r&&i==this.prevUserEvent&&i&&/^select($|\.)/.test(i)&&Nl(s[s.length-1],e)?this:new pe(Fr(this.done,e),this.undone,t,i)}addMapping(e){return new pe(pn(this.done,e),pn(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,i){let r=e==0?this.done:this.undone;if(r.length==0)return null;let s=r[r.length-1],o=s.selectionsAfter[0]||t.selection;if(i&&s.selectionsAfter.length)return t.update({selection:s.selectionsAfter[s.selectionsAfter.length-1],annotations:Tn.of({side:e,rest:Fl(r),selection:o}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(s.changes){let l=r.length==1?re:r.slice(0,r.length-1);return s.mapped&&(l=pn(l,s.mapped)),t.update({changes:s.changes,selection:s.startSelection,effects:s.effects,annotations:Tn.of({side:e,rest:l,selection:o}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}pe.empty=new pe(re,re);const zl=[{key:"Mod-z",run:Nr,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:In,preventDefault:!0},{linux:"Ctrl-Shift-z",run:In,preventDefault:!0},{key:"Mod-u",run:Ll,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:Ol,preventDefault:!0}];function Qe(n,e){return x.create(n.ranges.map(e),n.mainIndex)}function ge(n,e){return n.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function le({state:n,dispatch:e},t){let i=Qe(n.selection,t);return i.eq(n.selection,!0)?!1:(e(ge(n,i)),!0)}function rn(n,e){return x.cursor(e?n.to:n.from)}function Wr(n,e){return le(n,t=>t.empty?n.moveByChar(t,e):rn(t,e))}function V(n){return n.textDirectionAt(n.state.selection.main.head)==Et.LTR}const qr=n=>Wr(n,!V(n)),zr=n=>Wr(n,V(n));function _r(n,e){return le(n,t=>t.empty?n.moveByGroup(t,e):rn(t,e))}const _l=n=>_r(n,!V(n)),$l=n=>_r(n,V(n));function Ul(n,e,t){if(e.type.prop(t))return!0;let i=e.to-e.from;return i&&(i>2||/[^\s,.;:]/.test(n.sliceDoc(e.from,e.to)))||e.firstChild}function sn(n,e,t){let i=U(n).resolveInner(e.head),r=t?S.closedBy:S.openedBy;for(let a=e.head;;){let c=t?i.childAfter(a):i.childBefore(a);if(!c)break;Ul(n,c,r)?i=c:a=t?c.to:c.from}let s=i.type.prop(r),o,l;return s&&(o=t?de(n,i.from,1):de(n,i.to,-1))&&o.matched?l=t?o.end.to:o.end.from:l=t?i.to:i.from,x.cursor(l,t?-1:1)}const jl=n=>le(n,e=>sn(n.state,e,!V(n))),Hl=n=>le(n,e=>sn(n.state,e,V(n)));function $r(n,e){return le(n,t=>{if(!t.empty)return rn(t,e);let i=n.moveVertically(t,e);return i.head!=t.head?i:n.moveToLineBoundary(t,e)})}const Ur=n=>$r(n,!1),jr=n=>$r(n,!0);function Hr(n){let e=n.scrollDOM.clientHeight<n.scrollDOM.scrollHeight-2,t=0,i=0,r;if(e){for(let s of n.state.facet(T.scrollMargins)){let o=s(n);o!=null&&o.top&&(t=Math.max(o==null?void 0:o.top,t)),o!=null&&o.bottom&&(i=Math.max(o==null?void 0:o.bottom,i))}r=n.scrollDOM.clientHeight-t-i}else r=(n.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:t,marginBottom:i,selfScroll:e,height:Math.max(n.defaultLineHeight,r-5)}}function Vr(n,e){let t=Hr(n),{state:i}=n,r=Qe(i.selection,o=>o.empty?n.moveVertically(o,e,t.height):rn(o,e));if(r.eq(i.selection))return!1;let s;if(t.selfScroll){let o=n.coordsAtPos(i.selection.main.head),l=n.scrollDOM.getBoundingClientRect(),a=l.top+t.marginTop,c=l.bottom-t.marginBottom;o&&o.top>a&&o.bottom<c&&(s=T.scrollIntoView(r.main.head,{y:"start",yMargin:o.top-a}))}return n.dispatch(ge(i,r),{effects:s}),!0}const Ii=n=>Vr(n,!1),Pn=n=>Vr(n,!0);function Me(n,e,t){let i=n.lineBlockAt(e.head),r=n.moveToLineBoundary(e,t);if(r.head==e.head&&r.head!=(t?i.to:i.from)&&(r=n.moveToLineBoundary(e,t,!1)),!t&&r.head==i.from&&i.length){let s=/^\s*/.exec(n.state.sliceDoc(i.from,Math.min(i.from+100,i.to)))[0].length;s&&e.head!=i.from+s&&(r=x.cursor(i.from+s))}return r}const Vl=n=>le(n,e=>Me(n,e,!0)),Kl=n=>le(n,e=>Me(n,e,!1)),Gl=n=>le(n,e=>Me(n,e,!V(n))),Jl=n=>le(n,e=>Me(n,e,V(n))),Ql=n=>le(n,e=>x.cursor(n.lineBlockAt(e.head).from,1)),Zl=n=>le(n,e=>x.cursor(n.lineBlockAt(e.head).to,-1));function Yl(n,e,t){let i=!1,r=Qe(n.selection,s=>{let o=de(n,s.head,-1)||de(n,s.head,1)||s.head>0&&de(n,s.head-1,1)||s.head<n.doc.length&&de(n,s.head+1,-1);if(!o||!o.end)return s;i=!0;let l=o.start.from==s.head?o.end.to:o.end.from;return x.cursor(l)});return i?(e(ge(n,r)),!0):!1}const Xl=({state:n,dispatch:e})=>Yl(n,e);function oe(n,e){let t=Qe(n.state.selection,i=>{let r=e(i);return x.range(i.anchor,r.head,r.goalColumn,r.bidiLevel||void 0)});return t.eq(n.state.selection)?!1:(n.dispatch(ge(n.state,t)),!0)}function Kr(n,e){return oe(n,t=>n.moveByChar(t,e))}const Gr=n=>Kr(n,!V(n)),Jr=n=>Kr(n,V(n));function Qr(n,e){return oe(n,t=>n.moveByGroup(t,e))}const ea=n=>Qr(n,!V(n)),ta=n=>Qr(n,V(n)),na=n=>oe(n,e=>sn(n.state,e,!V(n))),ia=n=>oe(n,e=>sn(n.state,e,V(n)));function Zr(n,e){return oe(n,t=>n.moveVertically(t,e))}const Yr=n=>Zr(n,!1),Xr=n=>Zr(n,!0);function es(n,e){return oe(n,t=>n.moveVertically(t,e,Hr(n).height))}const Pi=n=>es(n,!1),Di=n=>es(n,!0),ra=n=>oe(n,e=>Me(n,e,!0)),sa=n=>oe(n,e=>Me(n,e,!1)),oa=n=>oe(n,e=>Me(n,e,!V(n))),la=n=>oe(n,e=>Me(n,e,V(n))),aa=n=>oe(n,e=>x.cursor(n.lineBlockAt(e.head).from)),ca=n=>oe(n,e=>x.cursor(n.lineBlockAt(e.head).to)),Bi=({state:n,dispatch:e})=>(e(ge(n,{anchor:0})),!0),Li=({state:n,dispatch:e})=>(e(ge(n,{anchor:n.doc.length})),!0),Oi=({state:n,dispatch:e})=>(e(ge(n,{anchor:n.selection.main.anchor,head:0})),!0),Ei=({state:n,dispatch:e})=>(e(ge(n,{anchor:n.selection.main.anchor,head:n.doc.length})),!0),fa=({state:n,dispatch:e})=>(e(n.update({selection:{anchor:0,head:n.doc.length},userEvent:"select"})),!0),ha=({state:n,dispatch:e})=>{let t=on(n).map(({from:i,to:r})=>x.range(i,Math.min(r+1,n.doc.length)));return e(n.update({selection:x.create(t),userEvent:"select"})),!0},ua=({state:n,dispatch:e})=>{let t=Qe(n.selection,i=>{let r=U(n),s=r.resolveStack(i.from,1);if(i.empty){let o=r.resolveStack(i.from,-1);o.node.from>=s.node.from&&o.node.to<=s.node.to&&(s=o)}for(let o=s;o;o=o.next){let{node:l}=o;if((l.from<i.from&&l.to>=i.to||l.to>i.to&&l.from<=i.from)&&o.next)return x.range(l.to,l.from)}return i});return t.eq(n.selection)?!1:(e(ge(n,t)),!0)},da=({state:n,dispatch:e})=>{let t=n.selection,i=null;return t.ranges.length>1?i=x.create([t.main]):t.main.empty||(i=x.create([x.cursor(t.main.head)])),i?(e(ge(n,i)),!0):!1};function yt(n,e){if(n.state.readOnly)return!1;let t="delete.selection",{state:i}=n,r=i.changeByRange(s=>{let{from:o,to:l}=s;if(o==l){let a=e(s);a<o?(t="delete.backward",a=Mt(n,a,!1)):a>o&&(t="delete.forward",a=Mt(n,a,!0)),o=Math.min(o,a),l=Math.max(l,a)}else o=Mt(n,o,!1),l=Mt(n,l,!0);return o==l?{range:s}:{changes:{from:o,to:l},range:x.cursor(o,o<s.head?-1:1)}});return r.changes.empty?!1:(n.dispatch(i.update(r,{scrollIntoView:!0,userEvent:t,effects:t=="delete.selection"?T.announce.of(i.phrase("Selection deleted")):void 0})),!0)}function Mt(n,e,t){if(n instanceof T)for(let i of n.state.facet(T.atomicRanges).map(r=>r(n)))i.between(e,e,(r,s)=>{r<e&&s>e&&(e=t?s:r)});return e}const ts=(n,e,t)=>yt(n,i=>{let r=i.from,{state:s}=n,o=s.doc.lineAt(r),l,a;if(t&&!e&&r>o.from&&r<o.from+200&&!/[^ \t]/.test(l=o.text.slice(0,r-o.from))){if(l[l.length-1]=="	")return r-1;let c=Jt(l,s.tabSize),f=c%Re(s)||Re(s);for(let h=0;h<f&&l[l.length-1-h]==" ";h++)r--;a=r}else a=Ne(o.text,r-o.from,e,e)+o.from,a==r&&o.number!=(e?s.doc.lines:1)?a+=e?1:-1:!e&&/[\ufe00-\ufe0f]/.test(o.text.slice(a-o.from,r-o.from))&&(a=Ne(o.text,a-o.from,!1,!1)+o.from);return a}),Dn=n=>ts(n,!1,!0),ns=n=>ts(n,!0,!1),is=(n,e)=>yt(n,t=>{let i=t.head,{state:r}=n,s=r.doc.lineAt(i),o=r.charCategorizer(i);for(let l=null;;){if(i==(e?s.to:s.from)){i==t.head&&s.number!=(e?r.doc.lines:1)&&(i+=e?1:-1);break}let a=Ne(s.text,i-s.from,e)+s.from,c=s.text.slice(Math.min(i,a)-s.from,Math.max(i,a)-s.from),f=o(c);if(l!=null&&f!=l)break;(c!=" "||i!=t.head)&&(l=f),i=a}return i}),rs=n=>is(n,!1),pa=n=>is(n,!0),ma=n=>yt(n,e=>{let t=n.lineBlockAt(e.head).to;return e.head<t?t:Math.min(n.state.doc.length,e.head+1)}),ga=n=>yt(n,e=>{let t=n.moveToLineBoundary(e,!1).head;return e.head>t?t:Math.max(0,e.head-1)}),ya=n=>yt(n,e=>{let t=n.moveToLineBoundary(e,!0).head;return e.head<t?t:Math.min(n.state.doc.length,e.head+1)}),ba=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=n.changeByRange(i=>({changes:{from:i.from,to:i.to,insert:On.of(["",""])},range:x.cursor(i.from)}));return e(n.update(t,{scrollIntoView:!0,userEvent:"input"})),!0},xa=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=n.changeByRange(i=>{if(!i.empty||i.from==0||i.from==n.doc.length)return{range:i};let r=i.from,s=n.doc.lineAt(r),o=r==s.from?r-1:Ne(s.text,r-s.from,!1)+s.from,l=r==s.to?r+1:Ne(s.text,r-s.from,!0)+s.from;return{changes:{from:o,to:l,insert:n.doc.slice(r,l).append(n.doc.slice(o,r))},range:x.cursor(l)}});return t.changes.empty?!1:(e(n.update(t,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function on(n){let e=[],t=-1;for(let i of n.selection.ranges){let r=n.doc.lineAt(i.from),s=n.doc.lineAt(i.to);if(!i.empty&&i.to==s.from&&(s=n.doc.lineAt(i.to-1)),t>=r.number){let o=e[e.length-1];o.to=s.to,o.ranges.push(i)}else e.push({from:r.from,to:s.to,ranges:[i]});t=s.number+1}return e}function ss(n,e,t){if(n.readOnly)return!1;let i=[],r=[];for(let s of on(n)){if(t?s.to==n.doc.length:s.from==0)continue;let o=n.doc.lineAt(t?s.to+1:s.from-1),l=o.length+1;if(t){i.push({from:s.to,to:o.to},{from:s.from,insert:o.text+n.lineBreak});for(let a of s.ranges)r.push(x.range(Math.min(n.doc.length,a.anchor+l),Math.min(n.doc.length,a.head+l)))}else{i.push({from:o.from,to:s.from},{from:s.to,insert:n.lineBreak+o.text});for(let a of s.ranges)r.push(x.range(a.anchor-l,a.head-l))}}return i.length?(e(n.update({changes:i,scrollIntoView:!0,selection:x.create(r,n.selection.mainIndex),userEvent:"move.line"})),!0):!1}const ka=({state:n,dispatch:e})=>ss(n,e,!1),wa=({state:n,dispatch:e})=>ss(n,e,!0);function os(n,e,t){if(n.readOnly)return!1;let i=[];for(let r of on(n))t?i.push({from:r.from,insert:n.doc.slice(r.from,r.to)+n.lineBreak}):i.push({from:r.to,insert:n.lineBreak+n.doc.slice(r.from,r.to)});return e(n.update({changes:i,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const va=({state:n,dispatch:e})=>os(n,e,!1),Sa=({state:n,dispatch:e})=>os(n,e,!0),Ca=n=>{if(n.state.readOnly)return!1;let{state:e}=n,t=e.changes(on(e).map(({from:r,to:s})=>(r>0?r--:s<e.doc.length&&s++,{from:r,to:s}))),i=Qe(e.selection,r=>{let s;if(n.lineWrapping){let o=n.lineBlockAt(r.head),l=n.coordsAtPos(r.head,r.assoc||1);l&&(s=o.bottom+n.documentTop-l.bottom+n.defaultLineHeight/2)}return n.moveVertically(r,!0,s)}).map(t);return n.dispatch({changes:t,selection:i,scrollIntoView:!0,userEvent:"delete.line"}),!0};function Aa(n,e){if(/\(\)|\[\]|\{\}/.test(n.sliceDoc(e-1,e+1)))return{from:e,to:e};let t=U(n).resolveInner(e),i=t.childBefore(e),r=t.childAfter(e),s;return i&&r&&i.to<=e&&r.from>=e&&(s=i.type.prop(S.closedBy))&&s.indexOf(r.name)>-1&&n.doc.lineAt(i.to).from==n.doc.lineAt(r.from).from&&!/\S/.test(n.sliceDoc(i.to,r.from))?{from:i.to,to:r.from}:null}const Ni=ls(!1),Ma=ls(!0);function ls(n){return({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=e.changeByRange(r=>{let{from:s,to:o}=r,l=e.doc.lineAt(s),a=!n&&s==o&&Aa(e,s);n&&(s=o=(o<=l.to?l:e.doc.lineAt(o)).to);let c=new Xt(e,{simulateBreak:s,simulateDoubleBreak:!!a}),f=_n(c,s);for(f==null&&(f=Jt(/^\s*/.exec(e.doc.lineAt(s).text)[0],e.tabSize));o<l.to&&/\s/.test(l.text[o-l.from]);)o++;a?{from:s,to:o}=a:s>l.from&&s<l.from+100&&!/\S/.test(l.text.slice(0,s))&&(s=l.from);let h=["",lt(e,f)];return a&&h.push(lt(e,c.lineIndent(l.from,-1))),{changes:{from:s,to:o,insert:On.of(h)},range:x.cursor(s+1+h[1].length)}});return t(e.update(i,{scrollIntoView:!0,userEvent:"input"})),!0}}function Kn(n,e){let t=-1;return n.changeByRange(i=>{let r=[];for(let o=i.from;o<=i.to;){let l=n.doc.lineAt(o);l.number>t&&(i.empty||i.to>l.from)&&(e(l,r,i),t=l.number),o=l.to+1}let s=n.changes(r);return{changes:r,range:x.range(s.mapPos(i.anchor,1),s.mapPos(i.head,1))}})}const Ta=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=Object.create(null),i=new Xt(n,{overrideIndentation:s=>{let o=t[s];return o??-1}}),r=Kn(n,(s,o,l)=>{let a=_n(i,s.from);if(a==null)return;/\S/.test(s.text)||(a=0);let c=/^\s*/.exec(s.text)[0],f=lt(n,a);(c!=f||l.from<s.from+c.length)&&(t[s.from]=a,o.push({from:s.from,to:s.from+c.length,insert:f}))});return r.changes.empty||e(n.update(r,{userEvent:"indent"})),!0},as=({state:n,dispatch:e})=>n.readOnly?!1:(e(n.update(Kn(n,(t,i)=>{i.push({from:t.from,insert:n.facet(Yt)})}),{userEvent:"input.indent"})),!0),cs=({state:n,dispatch:e})=>n.readOnly?!1:(e(n.update(Kn(n,(t,i)=>{let r=/^\s*/.exec(t.text)[0];if(!r)return;let s=Jt(r,n.tabSize),o=0,l=lt(n,Math.max(0,s-Re(n)));for(;o<r.length&&o<l.length&&r.charCodeAt(o)==l.charCodeAt(o);)o++;i.push({from:t.from+o,to:t.from+r.length,insert:l.slice(o)})}),{userEvent:"delete.dedent"})),!0),Ia=n=>(n.setTabFocusMode(),!0),Pa=[{key:"Ctrl-b",run:qr,shift:Gr,preventDefault:!0},{key:"Ctrl-f",run:zr,shift:Jr},{key:"Ctrl-p",run:Ur,shift:Yr},{key:"Ctrl-n",run:jr,shift:Xr},{key:"Ctrl-a",run:Ql,shift:aa},{key:"Ctrl-e",run:Zl,shift:ca},{key:"Ctrl-d",run:ns},{key:"Ctrl-h",run:Dn},{key:"Ctrl-k",run:ma},{key:"Ctrl-Alt-h",run:rs},{key:"Ctrl-o",run:ba},{key:"Ctrl-t",run:xa},{key:"Ctrl-v",run:Pn}],Da=[{key:"ArrowLeft",run:qr,shift:Gr,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:_l,shift:ea,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:Gl,shift:oa,preventDefault:!0},{key:"ArrowRight",run:zr,shift:Jr,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:$l,shift:ta,preventDefault:!0},{mac:"Cmd-ArrowRight",run:Jl,shift:la,preventDefault:!0},{key:"ArrowUp",run:Ur,shift:Yr,preventDefault:!0},{mac:"Cmd-ArrowUp",run:Bi,shift:Oi},{mac:"Ctrl-ArrowUp",run:Ii,shift:Pi},{key:"ArrowDown",run:jr,shift:Xr,preventDefault:!0},{mac:"Cmd-ArrowDown",run:Li,shift:Ei},{mac:"Ctrl-ArrowDown",run:Pn,shift:Di},{key:"PageUp",run:Ii,shift:Pi},{key:"PageDown",run:Pn,shift:Di},{key:"Home",run:Kl,shift:sa,preventDefault:!0},{key:"Mod-Home",run:Bi,shift:Oi},{key:"End",run:Vl,shift:ra,preventDefault:!0},{key:"Mod-End",run:Li,shift:Ei},{key:"Enter",run:Ni,shift:Ni},{key:"Mod-a",run:fa},{key:"Backspace",run:Dn,shift:Dn},{key:"Delete",run:ns},{key:"Mod-Backspace",mac:"Alt-Backspace",run:rs},{key:"Mod-Delete",mac:"Alt-Delete",run:pa},{mac:"Mod-Backspace",run:ga},{mac:"Mod-Delete",run:ya}].concat(Pa.map(n=>({mac:n.key,run:n.run,shift:n.shift}))),fs=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:jl,shift:na},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:Hl,shift:ia},{key:"Alt-ArrowUp",run:ka},{key:"Shift-Alt-ArrowUp",run:va},{key:"Alt-ArrowDown",run:wa},{key:"Shift-Alt-ArrowDown",run:Sa},{key:"Escape",run:da},{key:"Mod-Enter",run:Ma},{key:"Alt-l",mac:"Ctrl-l",run:ha},{key:"Mod-i",run:ua,preventDefault:!0},{key:"Mod-[",run:cs},{key:"Mod-]",run:as},{key:"Mod-Alt-\\",run:Ta},{key:"Shift-Mod-k",run:Ca},{key:"Shift-Mod-\\",run:Xl},{key:"Mod-/",run:vl},{key:"Alt-A",run:Cl},{key:"Ctrl-m",mac:"Shift-Alt-m",run:Ia}].concat(Da),Ba={key:"Tab",run:as,shift:cs};function B(){var n=arguments[0];typeof n=="string"&&(n=document.createElement(n));var e=1,t=arguments[1];if(t&&typeof t=="object"&&t.nodeType==null&&!Array.isArray(t)){for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var r=t[i];typeof r=="string"?n.setAttribute(i,r):r!=null&&(n[i]=r)}e++}for(;e<arguments.length;e++)hs(n,arguments[e]);return n}function hs(n,e){if(typeof e=="string")n.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)n.appendChild(e);else if(Array.isArray(e))for(var t=0;t<e.length;t++)hs(n,e[t]);else throw new RangeError("Unsupported child node: "+e)}const Ri=typeof String.prototype.normalize=="function"?n=>n.normalize("NFKD"):n=>n;class Ke{constructor(e,t,i=0,r=e.length,s,o){this.test=o,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(i,r),this.bufferStart=i,this.normalize=s?l=>s(Ri(l)):Ri,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return ee(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=Rn(e),i=this.bufferStart+this.bufferPos;this.bufferPos+=be(e);let r=this.normalize(t);if(r.length)for(let s=0,o=i;;s++){let l=r.charCodeAt(s),a=this.match(l,o,this.bufferPos+this.bufferStart);if(s==r.length-1){if(a)return this.value=a,this;break}o==i&&s<t.length&&t.charCodeAt(s)==l&&o++}}}match(e,t,i){let r=null;for(let s=0;s<this.matches.length;s+=2){let o=this.matches[s],l=!1;this.query.charCodeAt(o)==e&&(o==this.query.length-1?r={from:this.matches[s+1],to:i}:(this.matches[s]++,l=!0)),l||(this.matches.splice(s,2),s-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?r={from:t,to:i}:this.matches.push(1,t)),r&&this.test&&!this.test(r.from,r.to,this.buffer,this.bufferStart)&&(r=null),r}}typeof Symbol<"u"&&(Ke.prototype[Symbol.iterator]=function(){return this});const us={from:-1,to:-1,match:/.*/.exec("")},Gn="gm"+(/x/.unicode==null?"":"u");class ds{constructor(e,t,i,r=0,s=e.length){if(this.text=e,this.to=s,this.curLine="",this.done=!1,this.value=us,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new ps(e,t,i,r,s);this.re=new RegExp(t,Gn+(i!=null&&i.ignoreCase?"i":"")),this.test=i==null?void 0:i.test,this.iter=e.iter();let o=e.lineAt(r);this.curLineStart=o.from,this.matchPos=_t(e,r),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let i=this.curLineStart+t.index,r=i+t[0].length;if(this.matchPos=_t(this.text,r+(i==r?1:0)),i==this.curLineStart+this.curLine.length&&this.nextLine(),(i<r||i>this.value.to)&&(!this.test||this.test(i,r,t)))return this.value={from:i,to:r,match:t},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const mn=new WeakMap;class Ue{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,i){let r=mn.get(e);if(!r||r.from>=i||r.to<=t){let l=new Ue(t,e.sliceString(t,i));return mn.set(e,l),l}if(r.from==t&&r.to==i)return r;let{text:s,from:o}=r;return o>t&&(s=e.sliceString(t,o)+s,o=t),r.to<i&&(s+=e.sliceString(r.to,i)),mn.set(e,new Ue(o,s)),new Ue(t,s.slice(t-o,i-o))}}class ps{constructor(e,t,i,r,s){this.text=e,this.to=s,this.done=!1,this.value=us,this.matchPos=_t(e,r),this.re=new RegExp(t,Gn+(i!=null&&i.ignoreCase?"i":"")),this.test=i==null?void 0:i.test,this.flat=Ue.get(e,r,this.chunkEnd(r+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t){let i=this.flat.from+t.index,r=i+t[0].length;if((this.flat.to>=this.to||t.index+t[0].length<=this.flat.text.length-10)&&(!this.test||this.test(i,r,t)))return this.value={from:i,to:r,match:t},this.matchPos=_t(this.text,r+(i==r?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=Ue.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(ds.prototype[Symbol.iterator]=ps.prototype[Symbol.iterator]=function(){return this});function La(n){try{return new RegExp(n,Gn),!0}catch{return!1}}function _t(n,e){if(e>=n.length)return e;let t=n.lineAt(e),i;for(;e<t.to&&(i=t.text.charCodeAt(e-t.from))>=56320&&i<57344;)e++;return e}function Bn(n){let e=String(n.state.doc.lineAt(n.state.selection.main.head).number),t=B("input",{class:"cm-textfield",name:"line",value:e}),i=B("form",{class:"cm-gotoLine",onkeydown:s=>{s.keyCode==27?(s.preventDefault(),n.dispatch({effects:it.of(!1)}),n.focus()):s.keyCode==13&&(s.preventDefault(),r())},onsubmit:s=>{s.preventDefault(),r()}},B("label",n.state.phrase("Go to line"),": ",t)," ",B("button",{class:"cm-button",type:"submit"},n.state.phrase("go")),B("button",{name:"close",onclick:()=>{n.dispatch({effects:it.of(!1)}),n.focus()},"aria-label":n.state.phrase("close"),type:"button"},["×"]));function r(){let s=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(t.value);if(!s)return;let{state:o}=n,l=o.doc.lineAt(o.selection.main.head),[,a,c,f,h]=s,u=f?+f.slice(1):0,d=c?+c:l.number;if(c&&h){let C=d/100;a&&(C=C*(a=="-"?-1:1)+l.number/o.doc.lines),d=Math.round(o.doc.lines*C)}else c&&a&&(d=d*(a=="-"?-1:1)+l.number);let y=o.doc.line(Math.max(1,Math.min(o.doc.lines,d))),g=x.cursor(y.from+Math.max(0,Math.min(u,y.length)));n.dispatch({effects:[it.of(!1),T.scrollIntoView(g.from,{y:"center"})],selection:g}),n.focus()}return{dom:i}}const it=F.define(),Fi=me.define({create(){return!0},update(n,e){for(let t of e.effects)t.is(it)&&(n=t.value);return n},provide:n=>Nn.from(n,e=>e?Bn:null)}),Oa=n=>{let e=rt(n,Bn);if(!e){let t=[it.of(!0)];n.state.field(Fi,!1)==null&&t.push(F.appendConfig.of([Fi,Ea])),n.dispatch({effects:t}),e=rt(n,Bn)}return e&&e.dom.querySelector("input").select(),!0},Ea=T.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px",position:"relative","& label":{fontSize:"80%"},"& [name=close]":{position:"absolute",top:"0",bottom:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:"0"}}}),Na={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},Ra=H.define({combine(n){return We(n,Na,{highlightWordAroundCursor:(e,t)=>e||t,minSelectionLength:Math.min,maxMatches:Math.min})}});function Fa(n){return[$a,_a]}const Wa=A.mark({class:"cm-selectionMatch"}),qa=A.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function Wi(n,e,t,i){return(t==0||n(e.sliceDoc(t-1,t))!=K.Word)&&(i==e.doc.length||n(e.sliceDoc(i,i+1))!=K.Word)}function za(n,e,t,i){return n(e.sliceDoc(t,t+1))==K.Word&&n(e.sliceDoc(i-1,i))==K.Word}const _a=Je.fromClass(class{constructor(n){this.decorations=this.getDeco(n)}update(n){(n.selectionSet||n.docChanged||n.viewportChanged)&&(this.decorations=this.getDeco(n.view))}getDeco(n){let e=n.state.facet(Ra),{state:t}=n,i=t.selection;if(i.ranges.length>1)return A.none;let r=i.main,s,o=null;if(r.empty){if(!e.highlightWordAroundCursor)return A.none;let a=t.wordAt(r.head);if(!a)return A.none;o=t.charCategorizer(r.head),s=t.sliceDoc(a.from,a.to)}else{let a=r.to-r.from;if(a<e.minSelectionLength||a>200)return A.none;if(e.wholeWords){if(s=t.sliceDoc(r.from,r.to),o=t.charCategorizer(r.head),!(Wi(o,t,r.from,r.to)&&za(o,t,r.from,r.to)))return A.none}else if(s=t.sliceDoc(r.from,r.to),!s)return A.none}let l=[];for(let a of n.visibleRanges){let c=new Ke(t.doc,s,a.from,a.to);for(;!c.next().done;){let{from:f,to:h}=c.value;if((!o||Wi(o,t,f,h))&&(r.empty&&f<=r.from&&h>=r.to?l.push(qa.range(f,h)):(f>=r.to||h<=r.from)&&l.push(Wa.range(f,h)),l.length>e.maxMatches))return A.none}}return A.set(l)}},{decorations:n=>n.decorations}),$a=T.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),Ua=({state:n,dispatch:e})=>{let{selection:t}=n,i=x.create(t.ranges.map(r=>n.wordAt(r.head)||x.cursor(r.head)),t.mainIndex);return i.eq(t)?!1:(e(n.update({selection:i})),!0)};function ja(n,e){let{main:t,ranges:i}=n.selection,r=n.wordAt(t.head),s=r&&r.from==t.from&&r.to==t.to;for(let o=!1,l=new Ke(n.doc,e,i[i.length-1].to);;)if(l.next(),l.done){if(o)return null;l=new Ke(n.doc,e,0,Math.max(0,i[i.length-1].from-1)),o=!0}else{if(o&&i.some(a=>a.from==l.value.from))continue;if(s){let a=n.wordAt(l.value.from);if(!a||a.from!=l.value.from||a.to!=l.value.to)continue}return l.value}}const Ha=({state:n,dispatch:e})=>{let{ranges:t}=n.selection;if(t.some(s=>s.from===s.to))return Ua({state:n,dispatch:e});let i=n.sliceDoc(t[0].from,t[0].to);if(n.selection.ranges.some(s=>n.sliceDoc(s.from,s.to)!=i))return!1;let r=ja(n,i);return r?(e(n.update({selection:n.selection.addRange(x.range(r.from,r.to),!1),effects:T.scrollIntoView(r.to)})),!0):!1},Ze=H.define({combine(n){return We(n,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new ic(e),scrollToMatch:e=>T.scrollIntoView(e)})}});class ms{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||La(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(t,i)=>i=="n"?`
`:i=="r"?"\r":i=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new Ja(this):new Ka(this)}getCursor(e,t=0,i){let r=e.doc?e:Oe.create({doc:e});return i==null&&(i=r.doc.length),this.regexp?_e(this,r,t,i):ze(this,r,t,i)}}class gs{constructor(e){this.spec=e}}function ze(n,e,t,i){return new Ke(e.doc,n.unquoted,t,i,n.caseSensitive?void 0:r=>r.toLowerCase(),n.wholeWord?Va(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function Va(n,e){return(t,i,r,s)=>((s>t||s+r.length<i)&&(s=Math.max(0,t-2),r=n.sliceString(s,Math.min(n.length,i+2))),(e($t(r,t-s))!=K.Word||e(Ut(r,t-s))!=K.Word)&&(e(Ut(r,i-s))!=K.Word||e($t(r,i-s))!=K.Word))}class Ka extends gs{constructor(e){super(e)}nextMatch(e,t,i){let r=ze(this.spec,e,i,e.doc.length).nextOverlapping();if(r.done){let s=Math.min(e.doc.length,t+this.spec.unquoted.length);r=ze(this.spec,e,0,s).nextOverlapping()}return r.done||r.value.from==t&&r.value.to==i?null:r.value}prevMatchInRange(e,t,i){for(let r=i;;){let s=Math.max(t,r-1e4-this.spec.unquoted.length),o=ze(this.spec,e,s,r),l=null;for(;!o.nextOverlapping().done;)l=o.value;if(l)return l;if(s==t)return null;r-=1e4}}prevMatch(e,t,i){let r=this.prevMatchInRange(e,0,t);return r||(r=this.prevMatchInRange(e,Math.max(0,i-this.spec.unquoted.length),e.doc.length)),r&&(r.from!=t||r.to!=i)?r:null}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,t){let i=ze(this.spec,e,0,e.doc.length),r=[];for(;!i.next().done;){if(r.length>=t)return null;r.push(i.value)}return r}highlight(e,t,i,r){let s=ze(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(i+this.spec.unquoted.length,e.doc.length));for(;!s.next().done;)r(s.value.from,s.value.to)}}function _e(n,e,t,i){return new ds(e.doc,n.search,{ignoreCase:!n.caseSensitive,test:n.wholeWord?Ga(e.charCategorizer(e.selection.main.head)):void 0},t,i)}function $t(n,e){return n.slice(Ne(n,e,!1),e)}function Ut(n,e){return n.slice(e,Ne(n,e))}function Ga(n){return(e,t,i)=>!i[0].length||(n($t(i.input,i.index))!=K.Word||n(Ut(i.input,i.index))!=K.Word)&&(n(Ut(i.input,i.index+i[0].length))!=K.Word||n($t(i.input,i.index+i[0].length))!=K.Word)}class Ja extends gs{nextMatch(e,t,i){let r=_e(this.spec,e,i,e.doc.length).next();return r.done&&(r=_e(this.spec,e,0,t).next()),r.done?null:r.value}prevMatchInRange(e,t,i){for(let r=1;;r++){let s=Math.max(t,i-r*1e4),o=_e(this.spec,e,s,i),l=null;for(;!o.next().done;)l=o.value;if(l&&(s==t||l.from>s+10))return l;if(s==t)return null}}prevMatch(e,t,i){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,i,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace).replace(/\$([$&]|\d+)/g,(t,i)=>{if(i=="&")return e.match[0];if(i=="$")return"$";for(let r=i.length;r>0;r--){let s=+i.slice(0,r);if(s>0&&s<e.match.length)return e.match[s]+i.slice(r)}return t})}matchAll(e,t){let i=_e(this.spec,e,0,e.doc.length),r=[];for(;!i.next().done;){if(r.length>=t)return null;r.push(i.value)}return r}highlight(e,t,i,r){let s=_e(this.spec,e,Math.max(0,t-250),Math.min(i+250,e.doc.length));for(;!s.next().done;)r(s.value.from,s.value.to)}}const ct=F.define(),Jn=F.define(),Se=me.define({create(n){return new gn(Ln(n).create(),null)},update(n,e){for(let t of e.effects)t.is(ct)?n=new gn(t.value.create(),n.panel):t.is(Jn)&&(n=new gn(n.query,t.value?Qn:null));return n},provide:n=>Nn.from(n,e=>e.panel)});class gn{constructor(e,t){this.query=e,this.panel=t}}const Qa=A.mark({class:"cm-searchMatch"}),Za=A.mark({class:"cm-searchMatch cm-searchMatch-selected"}),Ya=Je.fromClass(class{constructor(n){this.view=n,this.decorations=this.highlight(n.state.field(Se))}update(n){let e=n.state.field(Se);(e!=n.startState.field(Se)||n.docChanged||n.selectionSet||n.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:n,panel:e}){if(!e||!n.spec.valid)return A.none;let{view:t}=this,i=new Gt;for(let r=0,s=t.visibleRanges,o=s.length;r<o;r++){let{from:l,to:a}=s[r];for(;r<o-1&&a>s[r+1].from-2*250;)a=s[++r].to;n.highlight(t.state,l,a,(c,f)=>{let h=t.state.selection.ranges.some(u=>u.from==c&&u.to==f);i.add(c,f,h?Za:Qa)})}return i.finish()}},{decorations:n=>n.decorations});function bt(n){return e=>{let t=e.state.field(Se,!1);return t&&t.query.spec.valid?n(e,t):xs(e)}}const jt=bt((n,{query:e})=>{let{to:t}=n.state.selection.main,i=e.nextMatch(n.state,t,t);if(!i)return!1;let r=x.single(i.from,i.to),s=n.state.facet(Ze);return n.dispatch({selection:r,effects:[Zn(n,i),s.scrollToMatch(r.main,n)],userEvent:"select.search"}),bs(n),!0}),Ht=bt((n,{query:e})=>{let{state:t}=n,{from:i}=t.selection.main,r=e.prevMatch(t,i,i);if(!r)return!1;let s=x.single(r.from,r.to),o=n.state.facet(Ze);return n.dispatch({selection:s,effects:[Zn(n,r),o.scrollToMatch(s.main,n)],userEvent:"select.search"}),bs(n),!0}),Xa=bt((n,{query:e})=>{let t=e.matchAll(n.state,1e3);return!t||!t.length?!1:(n.dispatch({selection:x.create(t.map(i=>x.range(i.from,i.to))),userEvent:"select.search.matches"}),!0)}),ec=({state:n,dispatch:e})=>{let t=n.selection;if(t.ranges.length>1||t.main.empty)return!1;let{from:i,to:r}=t.main,s=[],o=0;for(let l=new Ke(n.doc,n.sliceDoc(i,r));!l.next().done;){if(s.length>1e3)return!1;l.value.from==i&&(o=s.length),s.push(x.range(l.value.from,l.value.to))}return e(n.update({selection:x.create(s,o),userEvent:"select.search.matches"})),!0},qi=bt((n,{query:e})=>{let{state:t}=n,{from:i,to:r}=t.selection.main;if(t.readOnly)return!1;let s=e.nextMatch(t,i,i);if(!s)return!1;let o=s,l=[],a,c,f=[];if(o.from==i&&o.to==r&&(c=t.toText(e.getReplacement(o)),l.push({from:o.from,to:o.to,insert:c}),o=e.nextMatch(t,o.from,o.to),f.push(T.announce.of(t.phrase("replaced match on line $",t.doc.lineAt(i).number)+"."))),o){let h=l.length==0||l[0].from>=s.to?0:s.to-s.from-c.length;a=x.single(o.from-h,o.to-h),f.push(Zn(n,o)),f.push(t.facet(Ze).scrollToMatch(a.main,n))}return n.dispatch({changes:l,selection:a,effects:f,userEvent:"input.replace"}),!0}),tc=bt((n,{query:e})=>{if(n.state.readOnly)return!1;let t=e.matchAll(n.state,1e9).map(r=>{let{from:s,to:o}=r;return{from:s,to:o,insert:e.getReplacement(r)}});if(!t.length)return!1;let i=n.state.phrase("replaced $ matches",t.length)+".";return n.dispatch({changes:t,effects:T.announce.of(i),userEvent:"input.replace.all"}),!0});function Qn(n){return n.state.facet(Ze).createPanel(n)}function Ln(n,e){var t,i,r,s,o;let l=n.selection.main,a=l.empty||l.to>l.from+100?"":n.sliceDoc(l.from,l.to);if(e&&!a)return e;let c=n.facet(Ze);return new ms({search:((t=e==null?void 0:e.literal)!==null&&t!==void 0?t:c.literal)?a:a.replace(/\n/g,"\\n"),caseSensitive:(i=e==null?void 0:e.caseSensitive)!==null&&i!==void 0?i:c.caseSensitive,literal:(r=e==null?void 0:e.literal)!==null&&r!==void 0?r:c.literal,regexp:(s=e==null?void 0:e.regexp)!==null&&s!==void 0?s:c.regexp,wholeWord:(o=e==null?void 0:e.wholeWord)!==null&&o!==void 0?o:c.wholeWord})}function ys(n){let e=rt(n,Qn);return e&&e.dom.querySelector("[main-field]")}function bs(n){let e=ys(n);e&&e==n.root.activeElement&&e.select()}const xs=n=>{let e=n.state.field(Se,!1);if(e&&e.panel){let t=ys(n);if(t&&t!=n.root.activeElement){let i=Ln(n.state,e.query.spec);i.valid&&n.dispatch({effects:ct.of(i)}),t.focus(),t.select()}}else n.dispatch({effects:[Jn.of(!0),e?ct.of(Ln(n.state,e.query.spec)):F.appendConfig.of(sc)]});return!0},ks=n=>{let e=n.state.field(Se,!1);if(!e||!e.panel)return!1;let t=rt(n,Qn);return t&&t.dom.contains(n.root.activeElement)&&n.focus(),n.dispatch({effects:Jn.of(!1)}),!0},nc=[{key:"Mod-f",run:xs,scope:"editor search-panel"},{key:"F3",run:jt,shift:Ht,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:jt,shift:Ht,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:ks,scope:"editor search-panel"},{key:"Mod-Shift-l",run:ec},{key:"Mod-Alt-g",run:Oa},{key:"Mod-d",run:Ha,preventDefault:!0}];class ic{constructor(e){this.view=e;let t=this.query=e.state.field(Se).query.spec;this.commit=this.commit.bind(this),this.searchField=B("input",{value:t.search,placeholder:Z(e,"Find"),"aria-label":Z(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=B("input",{value:t.replace,placeholder:Z(e,"Replace"),"aria-label":Z(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=B("input",{type:"checkbox",name:"case",form:"",checked:t.caseSensitive,onchange:this.commit}),this.reField=B("input",{type:"checkbox",name:"re",form:"",checked:t.regexp,onchange:this.commit}),this.wordField=B("input",{type:"checkbox",name:"word",form:"",checked:t.wholeWord,onchange:this.commit});function i(r,s,o){return B("button",{class:"cm-button",name:r,onclick:s,type:"button"},o)}this.dom=B("div",{onkeydown:r=>this.keydown(r),class:"cm-search"},[this.searchField,i("next",()=>jt(e),[Z(e,"next")]),i("prev",()=>Ht(e),[Z(e,"previous")]),i("select",()=>Xa(e),[Z(e,"all")]),B("label",null,[this.caseField,Z(e,"match case")]),B("label",null,[this.reField,Z(e,"regexp")]),B("label",null,[this.wordField,Z(e,"by word")]),...e.state.readOnly?[]:[B("br"),this.replaceField,i("replace",()=>qi(e),[Z(e,"replace")]),i("replaceAll",()=>tc(e),[Z(e,"replace all")])],B("button",{name:"close",onclick:()=>ks(e),"aria-label":Z(e,"close"),type:"button"},["×"])])}commit(){let e=new ms({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:ct.of(e)}))}keydown(e){zs(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?Ht:jt)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),qi(this.view))}update(e){for(let t of e.transactions)for(let i of t.effects)i.is(ct)&&!i.value.eq(this.query)&&this.setQuery(i.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(Ze).top}}function Z(n,e){return n.state.phrase(e)}const Tt=30,It=/[\s\.,:;?!]/;function Zn(n,{from:e,to:t}){let i=n.state.doc.lineAt(e),r=n.state.doc.lineAt(t).to,s=Math.max(i.from,e-Tt),o=Math.min(r,t+Tt),l=n.state.sliceDoc(s,o);if(s!=i.from){for(let a=0;a<Tt;a++)if(!It.test(l[a+1])&&It.test(l[a])){l=l.slice(a);break}}if(o!=r){for(let a=l.length-1;a>l.length-Tt;a--)if(!It.test(l[a-1])&&It.test(l[a])){l=l.slice(0,a);break}}return T.announce.of(`${n.state.phrase("current match")}. ${l} ${n.state.phrase("on line")} ${i.number}.`)}const rc=T.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),sc=[Se,mt.low(Ya),rc];class ws{constructor(e,t,i,r){this.state=e,this.pos=t,this.explicit=i,this.view=r,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(e){let t=U(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),i=Math.max(t.from,this.pos-250),r=t.text.slice(i-t.from,this.pos-t.from),s=r.search(vs(e,!1));return s<0?null:{from:i+s,to:this.pos,text:r.slice(s)}}get aborted(){return this.abortListeners==null}addEventListener(e,t,i){e=="abort"&&this.abortListeners&&(this.abortListeners.push(t),i&&i.onDocChange&&(this.abortOnDocChange=!0))}}function zi(n){let e=Object.keys(n).join(""),t=/\w/.test(e);return t&&(e=e.replace(/\w/g,"")),`[${t?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function oc(n){let e=Object.create(null),t=Object.create(null);for(let{label:r}of n){e[r[0]]=!0;for(let s=1;s<r.length;s++)t[r[s]]=!0}let i=zi(e)+zi(t)+"*$";return[new RegExp("^"+i),new RegExp(i)]}function lc(n){let e=n.map(r=>typeof r=="string"?{label:r}:r),[t,i]=e.every(r=>/^\w+$/.test(r.label))?[/\w*$/,/\w+$/]:oc(e);return r=>{let s=r.matchBefore(i);return s||r.explicit?{from:s?s.from:r.pos,options:e,validFor:t}:null}}function Bf(n,e){return t=>{for(let i=U(t.state).resolveInner(t.pos,-1);i;i=i.parent){if(n.indexOf(i.name)>-1)return null;if(i.type.isTop)break}return e(t)}}class _i{constructor(e,t,i,r){this.completion=e,this.source=t,this.match=i,this.score=r}}function Ee(n){return n.selection.main.from}function vs(n,e){var t;let{source:i}=n,r=e&&i[0]!="^",s=i[i.length-1]!="$";return!r&&!s?n:new RegExp(`${r?"^":""}(?:${i})${s?"$":""}`,(t=n.flags)!==null&&t!==void 0?t:n.ignoreCase?"i":"")}const Yn=En.define();function ac(n,e,t,i){let{main:r}=n.selection,s=t-r.from,o=i-r.from;return Object.assign(Object.assign({},n.changeByRange(l=>{if(l!=r&&t!=i&&n.sliceDoc(l.from+s,l.from+o)!=n.sliceDoc(t,i))return{range:l};let a=n.toText(e);return{changes:{from:l.from+s,to:i==r.from?l.to:l.from+o,insert:a},range:x.cursor(l.from+s+a.length)}})),{scrollIntoView:!0,userEvent:"input.complete"})}const $i=new WeakMap;function cc(n){if(!Array.isArray(n))return n;let e=$i.get(n);return e||$i.set(n,e=lc(n)),e}const Vt=F.define(),ft=F.define();class fc{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let t=0;t<e.length;){let i=ee(e,t),r=be(i);this.chars.push(i);let s=e.slice(t,t+r),o=s.toUpperCase();this.folded.push(ee(o==s?s.toLowerCase():o,0)),t+=r}this.astral=e.length!=this.chars.length}ret(e,t){return this.score=e,this.matched=t,this}match(e){if(this.pattern.length==0)return this.ret(-100,[]);if(e.length<this.pattern.length)return null;let{chars:t,folded:i,any:r,precise:s,byWord:o}=this;if(t.length==1){let v=ee(e,0),I=be(v),W=I==e.length?0:-100;if(v!=t[0])if(v==i[0])W+=-200;else return null;return this.ret(W,[0,I])}let l=e.indexOf(this.pattern);if(l==0)return this.ret(e.length==this.pattern.length?0:-100,[0,this.pattern.length]);let a=t.length,c=0;if(l<0){for(let v=0,I=Math.min(e.length,200);v<I&&c<a;){let W=ee(e,v);(W==t[c]||W==i[c])&&(r[c++]=v),v+=be(W)}if(c<a)return null}let f=0,h=0,u=!1,d=0,y=-1,g=-1,C=/[a-z]/.test(e),P=!0;for(let v=0,I=Math.min(e.length,200),W=0;v<I&&h<a;){let k=ee(e,v);l<0&&(f<a&&k==t[f]&&(s[f++]=v),d<a&&(k==t[d]||k==i[d]?(d==0&&(y=v),g=v+1,d++):d=0));let D,b=k<255?k>=48&&k<=57||k>=97&&k<=122?2:k>=65&&k<=90?1:0:(D=Rn(k))!=D.toLowerCase()?1:D!=D.toUpperCase()?2:0;(!v||b==1&&C||W==0&&b!=0)&&(t[h]==k||i[h]==k&&(u=!0)?o[h++]=v:o.length&&(P=!1)),W=b,v+=be(k)}return h==a&&o[0]==0&&P?this.result(-100+(u?-200:0),o,e):d==a&&y==0?this.ret(-200-e.length+(g==e.length?0:-100),[0,g]):l>-1?this.ret(-700-e.length,[l,l+this.pattern.length]):d==a?this.ret(-900-e.length,[y,g]):h==a?this.result(-100+(u?-200:0)+-700+(P?0:-1100),o,e):t.length==2?null:this.result((r[0]?-700:0)+-200+-1100,r,e)}result(e,t,i){let r=[],s=0;for(let o of t){let l=o+(this.astral?be(ee(i,o)):1);s&&r[s-1]==o?r[s-1]=l:(r[s++]=o,r[s++]=l)}return this.ret(e-i.length,r)}}class hc{constructor(e){this.pattern=e,this.matched=[],this.score=0,this.folded=e.toLowerCase()}match(e){if(e.length<this.pattern.length)return null;let t=e.slice(0,this.pattern.length),i=t==this.pattern?0:t.toLowerCase()==this.folded?-200:null;return i==null?null:(this.matched=[0,t.length],this.score=i+(e.length==this.pattern.length?0:-100),this)}}const _=H.define({combine(n){return We(n,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:uc,filterStrict:!1,compareCompletions:(e,t)=>e.label.localeCompare(t.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(e,t)=>e&&t,closeOnBlur:(e,t)=>e&&t,icons:(e,t)=>e&&t,tooltipClass:(e,t)=>i=>Ui(e(i),t(i)),optionClass:(e,t)=>i=>Ui(e(i),t(i)),addToOptions:(e,t)=>e.concat(t),filterStrict:(e,t)=>e||t})}});function Ui(n,e){return n?e?n+" "+e:n:e}function uc(n,e,t,i,r,s){let o=n.textDirection==Et.RTL,l=o,a=!1,c="top",f,h,u=e.left-r.left,d=r.right-e.right,y=i.right-i.left,g=i.bottom-i.top;if(l&&u<Math.min(y,d)?l=!1:!l&&d<Math.min(y,u)&&(l=!0),y<=(l?u:d))f=Math.max(r.top,Math.min(t.top,r.bottom-g))-e.top,h=Math.min(400,l?u:d);else{a=!0,h=Math.min(400,(o?e.right:r.right-e.left)-30);let v=r.bottom-e.bottom;v>=g||v>e.top?f=t.bottom-e.top:(c="bottom",f=e.bottom-t.top)}let C=(e.bottom-e.top)/s.offsetHeight,P=(e.right-e.left)/s.offsetWidth;return{style:`${c}: ${f/C}px; max-width: ${h/P}px`,class:"cm-completionInfo-"+(a?o?"left-narrow":"right-narrow":l?"left":"right")}}function dc(n){let e=n.addToOptions.slice();return n.icons&&e.push({render(t){let i=document.createElement("div");return i.classList.add("cm-completionIcon"),t.type&&i.classList.add(...t.type.split(/\s+/g).map(r=>"cm-completionIcon-"+r)),i.setAttribute("aria-hidden","true"),i},position:20}),e.push({render(t,i,r,s){let o=document.createElement("span");o.className="cm-completionLabel";let l=t.displayLabel||t.label,a=0;for(let c=0;c<s.length;){let f=s[c++],h=s[c++];f>a&&o.appendChild(document.createTextNode(l.slice(a,f)));let u=o.appendChild(document.createElement("span"));u.appendChild(document.createTextNode(l.slice(f,h))),u.className="cm-completionMatchedText",a=h}return a<l.length&&o.appendChild(document.createTextNode(l.slice(a))),o},position:50},{render(t){if(!t.detail)return null;let i=document.createElement("span");return i.className="cm-completionDetail",i.textContent=t.detail,i},position:80}),e.sort((t,i)=>t.position-i.position).map(t=>t.render)}function yn(n,e,t){if(n<=t)return{from:0,to:n};if(e<0&&(e=0),e<=n>>1){let r=Math.floor(e/t);return{from:r*t,to:(r+1)*t}}let i=Math.floor((n-e)/t);return{from:n-(i+1)*t,to:n-i*t}}class pc{constructor(e,t,i){this.view=e,this.stateField=t,this.applyCompletion=i,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:a=>this.placeInfo(a),key:this},this.space=null,this.currentClass="";let r=e.state.field(t),{options:s,selected:o}=r.open,l=e.state.facet(_);this.optionContent=dc(l),this.optionClass=l.optionClass,this.tooltipClass=l.tooltipClass,this.range=yn(s.length,o,l.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",a=>{let{options:c}=e.state.field(t).open;for(let f=a.target,h;f&&f!=this.dom;f=f.parentNode)if(f.nodeName=="LI"&&(h=/-(\d+)$/.exec(f.id))&&+h[1]<c.length){this.applyCompletion(e,c[+h[1]]),a.preventDefault();return}}),this.dom.addEventListener("focusout",a=>{let c=e.state.field(this.stateField,!1);c&&c.tooltip&&e.state.facet(_).closeOnBlur&&a.relatedTarget!=e.contentDOM&&e.dispatch({effects:ft.of(null)})}),this.showOptions(s,r.id)}mount(){this.updateSel()}showOptions(e,t){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e,t,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(e){var t;let i=e.state.field(this.stateField),r=e.startState.field(this.stateField);if(this.updateTooltipClass(e.state),i!=r){let{options:s,selected:o,disabled:l}=i.open;(!r.open||r.open.options!=s)&&(this.range=yn(s.length,o,e.state.facet(_).maxRenderedOptions),this.showOptions(s,i.id)),this.updateSel(),l!=((t=r.open)===null||t===void 0?void 0:t.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!l)}}updateTooltipClass(e){let t=this.tooltipClass(e);if(t!=this.currentClass){for(let i of this.currentClass.split(" "))i&&this.dom.classList.remove(i);for(let i of t.split(" "))i&&this.dom.classList.add(i);this.currentClass=t}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;if((t.selected>-1&&t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=yn(t.options.length,t.selected,this.view.state.facet(_).maxRenderedOptions),this.showOptions(t.options,e.id)),this.updateSelectedOption(t.selected)){this.destroyInfo();let{completion:i}=t.options[t.selected],{info:r}=i;if(!r)return;let s=typeof r=="string"?document.createTextNode(r):r(i);if(!s)return;"then"in s?s.then(o=>{o&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(o,i)}).catch(o=>Ot(this.view.state,o,"completion info")):this.addInfoPane(s,i)}}addInfoPane(e,t){this.destroyInfo();let i=this.info=document.createElement("div");if(i.className="cm-tooltip cm-completionInfo",e.nodeType!=null)i.appendChild(e),this.infoDestroy=null;else{let{dom:r,destroy:s}=e;i.appendChild(r),this.infoDestroy=s||null}this.dom.appendChild(i),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let t=null;for(let i=this.list.firstChild,r=this.range.from;i;i=i.nextSibling,r++)i.nodeName!="LI"||!i.id?r--:r==e?i.hasAttribute("aria-selected")||(i.setAttribute("aria-selected","true"),t=i):i.hasAttribute("aria-selected")&&i.removeAttribute("aria-selected");return t&&gc(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),i=this.info.getBoundingClientRect(),r=e.getBoundingClientRect(),s=this.space;if(!s){let o=this.dom.ownerDocument.documentElement;s={left:0,top:0,right:o.clientWidth,bottom:o.clientHeight}}return r.top>Math.min(s.bottom,t.bottom)-10||r.bottom<Math.max(s.top,t.top)+10?null:this.view.state.facet(_).positionInfo(this.view,t,r,i,s,this.dom)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,t,i){const r=document.createElement("ul");r.id=t,r.setAttribute("role","listbox"),r.setAttribute("aria-expanded","true"),r.setAttribute("aria-label",this.view.state.phrase("Completions")),r.addEventListener("mousedown",o=>{o.target==r&&o.preventDefault()});let s=null;for(let o=i.from;o<i.to;o++){let{completion:l,match:a}=e[o],{section:c}=l;if(c){let u=typeof c=="string"?c:c.name;if(u!=s&&(o>i.from||i.from==0))if(s=u,typeof c!="string"&&c.header)r.appendChild(c.header(c));else{let d=r.appendChild(document.createElement("completion-section"));d.textContent=u}}const f=r.appendChild(document.createElement("li"));f.id=t+"-"+o,f.setAttribute("role","option");let h=this.optionClass(l);h&&(f.className=h);for(let u of this.optionContent){let d=u(l,this.view.state,this.view,a);d&&f.appendChild(d)}}return i.from&&r.classList.add("cm-completionListIncompleteTop"),i.to<e.length&&r.classList.add("cm-completionListIncompleteBottom"),r}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function mc(n,e){return t=>new pc(t,n,e)}function gc(n,e){let t=n.getBoundingClientRect(),i=e.getBoundingClientRect(),r=t.height/n.offsetHeight;i.top<t.top?n.scrollTop-=(t.top-i.top)/r:i.bottom>t.bottom&&(n.scrollTop+=(i.bottom-t.bottom)/r)}function ji(n){return(n.boost||0)*100+(n.apply?10:0)+(n.info?5:0)+(n.type?1:0)}function yc(n,e){let t=[],i=null,r=c=>{t.push(c);let{section:f}=c.completion;if(f){i||(i=[]);let h=typeof f=="string"?f:f.name;i.some(u=>u.name==h)||i.push(typeof f=="string"?{name:h}:f)}},s=e.facet(_);for(let c of n)if(c.hasResult()){let f=c.result.getMatch;if(c.result.filter===!1)for(let h of c.result.options)r(new _i(h,c.source,f?f(h):[],1e9-t.length));else{let h=e.sliceDoc(c.from,c.to),u,d=s.filterStrict?new hc(h):new fc(h);for(let y of c.result.options)if(u=d.match(y.label)){let g=y.displayLabel?f?f(y,u.matched):[]:u.matched;r(new _i(y,c.source,g,u.score+(y.boost||0)))}}}if(i){let c=Object.create(null),f=0,h=(u,d)=>{var y,g;return((y=u.rank)!==null&&y!==void 0?y:1e9)-((g=d.rank)!==null&&g!==void 0?g:1e9)||(u.name<d.name?-1:1)};for(let u of i.sort(h))f-=1e5,c[u.name]=f;for(let u of t){let{section:d}=u.completion;d&&(u.score+=c[typeof d=="string"?d:d.name])}}let o=[],l=null,a=s.compareCompletions;for(let c of t.sort((f,h)=>h.score-f.score||a(f.completion,h.completion))){let f=c.completion;!l||l.label!=f.label||l.detail!=f.detail||l.type!=null&&f.type!=null&&l.type!=f.type||l.apply!=f.apply||l.boost!=f.boost?o.push(c):ji(c.completion)>ji(l)&&(o[o.length-1]=c),l=c.completion}return o}class $e{constructor(e,t,i,r,s,o){this.options=e,this.attrs=t,this.tooltip=i,this.timestamp=r,this.selected=s,this.disabled=o}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new $e(this.options,Hi(t,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,t,i,r,s,o){if(r&&!o&&e.some(c=>c.isPending))return r.setDisabled();let l=yc(e,t);if(!l.length)return r&&e.some(c=>c.isPending)?r.setDisabled():null;let a=t.facet(_).selectOnOpen?0:-1;if(r&&r.selected!=a&&r.selected!=-1){let c=r.options[r.selected].completion;for(let f=0;f<l.length;f++)if(l[f].completion==c){a=f;break}}return new $e(l,Hi(i,a),{pos:e.reduce((c,f)=>f.hasResult()?Math.min(c,f.from):c,1e8),create:Sc,above:s.aboveCursor},r?r.timestamp:Date.now(),a,!1)}map(e){return new $e(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}setDisabled(){return new $e(this.options,this.attrs,this.tooltip,this.timestamp,this.selected,!0)}}class Kt{constructor(e,t,i){this.active=e,this.id=t,this.open=i}static start(){return new Kt(wc,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:t}=e,i=t.facet(_),s=(i.override||t.languageDataAt("autocomplete",Ee(t)).map(cc)).map(a=>(this.active.find(f=>f.source==a)||new se(a,this.active.some(f=>f.state!=0)?1:0)).update(e,i));s.length==this.active.length&&s.every((a,c)=>a==this.active[c])&&(s=this.active);let o=this.open,l=e.effects.some(a=>a.is(Xn));o&&e.docChanged&&(o=o.map(e.changes)),e.selection||s.some(a=>a.hasResult()&&e.changes.touchesRange(a.from,a.to))||!bc(s,this.active)||l?o=$e.build(s,t,this.id,o,i,l):o&&o.disabled&&!s.some(a=>a.isPending)&&(o=null),!o&&s.every(a=>!a.isPending)&&s.some(a=>a.hasResult())&&(s=s.map(a=>a.hasResult()?new se(a.source,0):a));for(let a of e.effects)a.is(Cs)&&(o=o&&o.setSelected(a.value,this.id));return s==this.active&&o==this.open?this:new Kt(s,this.id,o)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?xc:kc}}function bc(n,e){if(n==e)return!0;for(let t=0,i=0;;){for(;t<n.length&&!n[t].hasResult();)t++;for(;i<e.length&&!e[i].hasResult();)i++;let r=t==n.length,s=i==e.length;if(r||s)return r==s;if(n[t++].result!=e[i++].result)return!1}}const xc={"aria-autocomplete":"list"},kc={};function Hi(n,e){let t={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":n};return e>-1&&(t["aria-activedescendant"]=n+"-"+e),t}const wc=[];function Ss(n,e){if(n.isUserEvent("input.complete")){let i=n.annotation(Yn);if(i&&e.activateOnCompletion(i))return 12}let t=n.isUserEvent("input.type");return t&&e.activateOnTyping?5:t?1:n.isUserEvent("delete.backward")?2:n.selection?8:n.docChanged?16:0}class se{constructor(e,t,i=!1){this.source=e,this.state=t,this.explicit=i}hasResult(){return!1}get isPending(){return this.state==1}update(e,t){let i=Ss(e,t),r=this;(i&8||i&16&&this.touches(e))&&(r=new se(r.source,0)),i&4&&r.state==0&&(r=new se(this.source,1)),r=r.updateFor(e,i);for(let s of e.effects)if(s.is(Vt))r=new se(r.source,1,s.value);else if(s.is(ft))r=new se(r.source,0);else if(s.is(Xn))for(let o of s.value)o.source==r.source&&(r=o);return r}updateFor(e,t){return this.map(e.changes)}map(e){return this}touches(e){return e.changes.touchesRange(Ee(e.state))}}class je extends se{constructor(e,t,i,r,s,o){super(e,3,t),this.limit=i,this.result=r,this.from=s,this.to=o}hasResult(){return!0}updateFor(e,t){var i;if(!(t&3))return this.map(e.changes);let r=this.result;r.map&&!e.changes.empty&&(r=r.map(r,e.changes));let s=e.changes.mapPos(this.from),o=e.changes.mapPos(this.to,1),l=Ee(e.state);if(l>o||!r||t&2&&(Ee(e.startState)==this.from||l<this.limit))return new se(this.source,t&4?1:0);let a=e.changes.mapPos(this.limit);return vc(r.validFor,e.state,s,o)?new je(this.source,this.explicit,a,r,s,o):r.update&&(r=r.update(r,s,o,new ws(e.state,l,!1)))?new je(this.source,this.explicit,a,r,r.from,(i=r.to)!==null&&i!==void 0?i:Ee(e.state)):new se(this.source,1,this.explicit)}map(e){return e.empty?this:(this.result.map?this.result.map(this.result,e):this.result)?new je(this.source,this.explicit,e.mapPos(this.limit),this.result,e.mapPos(this.from),e.mapPos(this.to,1)):new se(this.source,0)}touches(e){return e.changes.touchesRange(this.from,this.to)}}function vc(n,e,t,i){if(!n)return!1;let r=e.sliceDoc(t,i);return typeof n=="function"?n(r,t,i,e):vs(n,!0).test(r)}const Xn=F.define({map(n,e){return n.map(t=>t.map(e))}}),Cs=F.define(),J=me.define({create(){return Kt.start()},update(n,e){return n.update(e)},provide:n=>[_s.from(n,e=>e.tooltip),T.contentAttributes.from(n,e=>e.attrs)]});function ei(n,e){const t=e.completion.apply||e.completion.label;let i=n.state.field(J).active.find(r=>r.source==e.source);return i instanceof je?(typeof t=="string"?n.dispatch(Object.assign(Object.assign({},ac(n.state,t,i.from,i.to)),{annotations:Yn.of(e.completion)})):t(n,e.completion,i.from,i.to),!0):!1}const Sc=mc(J,ei);function Pt(n,e="option"){return t=>{let i=t.state.field(J,!1);if(!i||!i.open||i.open.disabled||Date.now()-i.open.timestamp<t.state.facet(_).interactionDelay)return!1;let r=1,s;e=="page"&&(s=er(t,i.open.tooltip))&&(r=Math.max(2,Math.floor(s.dom.offsetHeight/s.dom.querySelector("li").offsetHeight)-1));let{length:o}=i.open.options,l=i.open.selected>-1?i.open.selected+r*(n?1:-1):n?0:o-1;return l<0?l=e=="page"?0:o-1:l>=o&&(l=e=="page"?o-1:0),t.dispatch({effects:Cs.of(l)}),!0}}const Cc=n=>{let e=n.state.field(J,!1);return n.state.readOnly||!e||!e.open||e.open.selected<0||e.open.disabled||Date.now()-e.open.timestamp<n.state.facet(_).interactionDelay?!1:ei(n,e.open.options[e.open.selected])},Vi=n=>n.state.field(J,!1)?(n.dispatch({effects:Vt.of(!0)}),!0):!1,Ac=n=>{let e=n.state.field(J,!1);return!e||!e.active.some(t=>t.state!=0)?!1:(n.dispatch({effects:ft.of(null)}),!0)};class Mc{constructor(e,t){this.active=e,this.context=t,this.time=Date.now(),this.updates=[],this.done=void 0}}const Tc=50,Ic=1e3,Pc=Je.fromClass(class{constructor(n){this.view=n,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let e of n.state.field(J).active)e.isPending&&this.startQuery(e)}update(n){let e=n.state.field(J),t=n.state.facet(_);if(!n.selectionSet&&!n.docChanged&&n.startState.field(J)==e)return;let i=n.transactions.some(s=>{let o=Ss(s,t);return o&8||(s.selection||s.docChanged)&&!(o&3)});for(let s=0;s<this.running.length;s++){let o=this.running[s];if(i||o.context.abortOnDocChange&&n.docChanged||o.updates.length+n.transactions.length>Tc&&Date.now()-o.time>Ic){for(let l of o.context.abortListeners)try{l()}catch(a){Ot(this.view.state,a)}o.context.abortListeners=null,this.running.splice(s--,1)}else o.updates.push(...n.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),n.transactions.some(s=>s.effects.some(o=>o.is(Vt)))&&(this.pendingStart=!0);let r=this.pendingStart?50:t.activateOnTypingDelay;if(this.debounceUpdate=e.active.some(s=>s.isPending&&!this.running.some(o=>o.active.source==s.source))?setTimeout(()=>this.startUpdate(),r):-1,this.composing!=0)for(let s of n.transactions)s.isUserEvent("input.type")?this.composing=2:this.composing==2&&s.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:n}=this.view,e=n.field(J);for(let t of e.active)t.isPending&&!this.running.some(i=>i.active.source==t.source)&&this.startQuery(t);this.running.length&&e.open&&e.open.disabled&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(_).updateSyncTime))}startQuery(n){let{state:e}=this.view,t=Ee(e),i=new ws(e,t,n.explicit,this.view),r=new Mc(n,i);this.running.push(r),Promise.resolve(n.source(i)).then(s=>{r.context.aborted||(r.done=s||null,this.scheduleAccept())},s=>{this.view.dispatch({effects:ft.of(null)}),Ot(this.view.state,s)})}scheduleAccept(){this.running.every(n=>n.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(_).updateSyncTime))}accept(){var n;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],t=this.view.state.facet(_),i=this.view.state.field(J);for(let r=0;r<this.running.length;r++){let s=this.running[r];if(s.done===void 0)continue;if(this.running.splice(r--,1),s.done){let l=Ee(s.updates.length?s.updates[0].startState:this.view.state),a=Math.min(l,s.done.from+(s.active.explicit?0:1)),c=new je(s.active.source,s.active.explicit,a,s.done,s.done.from,(n=s.done.to)!==null&&n!==void 0?n:l);for(let f of s.updates)c=c.update(f,t);if(c.hasResult()){e.push(c);continue}}let o=i.active.find(l=>l.source==s.active.source);if(o&&o.isPending)if(s.done==null){let l=new se(s.active.source,0);for(let a of s.updates)l=l.update(a,t);l.isPending||e.push(l)}else this.startQuery(o)}(e.length||i.open&&i.open.disabled)&&this.view.dispatch({effects:Xn.of(e)})}},{eventHandlers:{blur(n){let e=this.view.state.field(J,!1);if(e&&e.tooltip&&this.view.state.facet(_).closeOnBlur){let t=e.open&&er(this.view,e.open.tooltip);(!t||!t.dom.contains(n.relatedTarget))&&setTimeout(()=>this.view.dispatch({effects:ft.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:Vt.of(!1)}),20),this.composing=0}}}),Dc=typeof navigator=="object"&&/Win/.test(navigator.platform),Bc=mt.highest(T.domEventHandlers({keydown(n,e){let t=e.state.field(J,!1);if(!t||!t.open||t.open.disabled||t.open.selected<0||n.key.length>1||n.ctrlKey&&!(Dc&&n.altKey)||n.metaKey)return!1;let i=t.open.options[t.open.selected],r=t.active.find(o=>o.source==i.source),s=i.completion.commitCharacters||r.result.commitCharacters;return s&&s.indexOf(n.key)>-1&&ei(e,i),!1}})),As=T.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class Lc{constructor(e,t,i,r){this.field=e,this.line=t,this.from=i,this.to=r}}class ti{constructor(e,t,i){this.field=e,this.from=t,this.to=i}map(e){let t=e.mapPos(this.from,-1,xn.TrackDel),i=e.mapPos(this.to,1,xn.TrackDel);return t==null||i==null?null:new ti(this.field,t,i)}}class ni{constructor(e,t){this.lines=e,this.fieldPositions=t}instantiate(e,t){let i=[],r=[t],s=e.doc.lineAt(t),o=/^\s*/.exec(s.text)[0];for(let a of this.lines){if(i.length){let c=o,f=/^\t*/.exec(a)[0].length;for(let h=0;h<f;h++)c+=e.facet(Yt);r.push(t+c.length-f),a=c+a.slice(f)}i.push(a),t+=a.length+1}let l=this.fieldPositions.map(a=>new ti(a.field,r[a.line]+a.from,r[a.line]+a.to));return{text:i,ranges:l}}static parse(e){let t=[],i=[],r=[],s;for(let o of e.split(/\r\n?|\n/)){for(;s=/[#$]\{(?:(\d+)(?::([^}]*))?|((?:\\[{}]|[^}])*))\}/.exec(o);){let l=s[1]?+s[1]:null,a=s[2]||s[3]||"",c=-1,f=a.replace(/\\[{}]/g,h=>h[1]);for(let h=0;h<t.length;h++)(l!=null?t[h].seq==l:f&&t[h].name==f)&&(c=h);if(c<0){let h=0;for(;h<t.length&&(l==null||t[h].seq!=null&&t[h].seq<l);)h++;t.splice(h,0,{seq:l,name:f}),c=h;for(let u of r)u.field>=c&&u.field++}r.push(new Lc(c,i.length,s.index,s.index+f.length)),o=o.slice(0,s.index)+a+o.slice(s.index+s[0].length)}o=o.replace(/\\([{}])/g,(l,a,c)=>{for(let f of r)f.line==i.length&&f.from>c&&(f.from--,f.to--);return a}),i.push(o)}return new ni(i,r)}}let Oc=A.widget({widget:new class extends Qt{toDOM(){let n=document.createElement("span");return n.className="cm-snippetFieldPosition",n}ignoreEvent(){return!1}}}),Ec=A.mark({class:"cm-snippetField"});class Ye{constructor(e,t){this.ranges=e,this.active=t,this.deco=A.set(e.map(i=>(i.from==i.to?Oc:Ec).range(i.from,i.to)))}map(e){let t=[];for(let i of this.ranges){let r=i.map(e);if(!r)return null;t.push(r)}return new Ye(t,this.active)}selectionInsideField(e){return e.ranges.every(t=>this.ranges.some(i=>i.field==this.active&&i.from<=t.from&&i.to>=t.to))}}const xt=F.define({map(n,e){return n&&n.map(e)}}),Nc=F.define(),ht=me.define({create(){return null},update(n,e){for(let t of e.effects){if(t.is(xt))return t.value;if(t.is(Nc)&&n)return new Ye(n.ranges,t.value)}return n&&e.docChanged&&(n=n.map(e.changes)),n&&e.selection&&!n.selectionInsideField(e.selection)&&(n=null),n},provide:n=>T.decorations.from(n,e=>e?e.deco:A.none)});function ii(n,e){return x.create(n.filter(t=>t.field==e).map(t=>x.range(t.from,t.to)))}function Rc(n){let e=ni.parse(n);return(t,i,r,s)=>{let{text:o,ranges:l}=e.instantiate(t.state,r),{main:a}=t.state.selection,c={changes:{from:r,to:s==a.from?a.to:s,insert:On.of(o)},scrollIntoView:!0,annotations:i?[Yn.of(i),Bt.userEvent.of("input.complete")]:void 0};if(l.length&&(c.selection=ii(l,0)),l.some(f=>f.field>0)){let f=new Ye(l,0),h=c.effects=[xt.of(f)];t.state.field(ht,!1)===void 0&&h.push(F.appendConfig.of([ht,_c,$c,As]))}t.dispatch(t.state.update(c))}}function Ms(n){return({state:e,dispatch:t})=>{let i=e.field(ht,!1);if(!i||n<0&&i.active==0)return!1;let r=i.active+n,s=n>0&&!i.ranges.some(o=>o.field==r+n);return t(e.update({selection:ii(i.ranges,r),effects:xt.of(s?null:new Ye(i.ranges,r)),scrollIntoView:!0})),!0}}const Fc=({state:n,dispatch:e})=>n.field(ht,!1)?(e(n.update({effects:xt.of(null)})),!0):!1,Wc=Ms(1),qc=Ms(-1),zc=[{key:"Tab",run:Wc,shift:qc},{key:"Escape",run:Fc}],Ki=H.define({combine(n){return n.length?n[0]:zc}}),_c=mt.highest(Zt.compute([Ki],n=>n.facet(Ki)));function Lf(n,e){return Object.assign(Object.assign({},e),{apply:Rc(n)})}const $c=T.domEventHandlers({mousedown(n,e){let t=e.state.field(ht,!1),i;if(!t||(i=e.posAtCoords({x:n.clientX,y:n.clientY}))==null)return!1;let r=t.ranges.find(s=>s.from<=i&&s.to>=i);return!r||r.field==t.active?!1:(e.dispatch({selection:ii(t.ranges,r.field),effects:xt.of(t.ranges.some(s=>s.field>r.field)?new Ye(t.ranges,r.field):null),scrollIntoView:!0}),!0)}}),ut={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},Le=F.define({map(n,e){let t=e.mapPos(n,-1,xn.TrackAfter);return t??void 0}}),ri=new class extends $s{};ri.startSide=1;ri.endSide=-1;const Ts=me.define({create(){return Xi.empty},update(n,e){if(n=n.map(e.changes),e.selection){let t=e.state.doc.lineAt(e.selection.main.head);n=n.update({filter:i=>i>=t.from&&i<=t.to})}for(let t of e.effects)t.is(Le)&&(n=n.update({add:[ri.range(t.value,t.value+1)]}));return n}});function Uc(){return[Hc,Ts]}const bn="()[]{}<>«»»«［］｛｝";function Is(n){for(let e=0;e<bn.length;e+=2)if(bn.charCodeAt(e)==n)return bn.charAt(e+1);return Rn(n<128?n:n+1)}function Ps(n,e){return n.languageDataAt("closeBrackets",e)[0]||ut}const jc=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),Hc=T.inputHandler.of((n,e,t,i)=>{if((jc?n.composing:n.compositionStarted)||n.state.readOnly)return!1;let r=n.state.selection.main;if(i.length>2||i.length==2&&be(ee(i,0))==1||e!=r.from||t!=r.to)return!1;let s=Gc(n.state,i);return s?(n.dispatch(s),!0):!1}),Vc=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let i=Ps(n,n.selection.main.head).brackets||ut.brackets,r=null,s=n.changeByRange(o=>{if(o.empty){let l=Jc(n.doc,o.head);for(let a of i)if(a==l&&ln(n.doc,o.head)==Is(ee(a,0)))return{changes:{from:o.head-a.length,to:o.head+a.length},range:x.cursor(o.head-a.length)}}return{range:r=o}});return r||e(n.update(s,{scrollIntoView:!0,userEvent:"delete.backward"})),!r},Kc=[{key:"Backspace",run:Vc}];function Gc(n,e){let t=Ps(n,n.selection.main.head),i=t.brackets||ut.brackets;for(let r of i){let s=Is(ee(r,0));if(e==r)return s==r?Yc(n,r,i.indexOf(r+r+r)>-1,t):Qc(n,r,s,t.before||ut.before);if(e==s&&Ds(n,n.selection.main.from))return Zc(n,r,s)}return null}function Ds(n,e){let t=!1;return n.field(Ts).between(0,n.doc.length,i=>{i==e&&(t=!0)}),t}function ln(n,e){let t=n.sliceString(e,e+2);return t.slice(0,be(ee(t,0)))}function Jc(n,e){let t=n.sliceString(e-2,e);return be(ee(t,0))==t.length?t:t.slice(1)}function Qc(n,e,t,i){let r=null,s=n.changeByRange(o=>{if(!o.empty)return{changes:[{insert:e,from:o.from},{insert:t,from:o.to}],effects:Le.of(o.to+e.length),range:x.range(o.anchor+e.length,o.head+e.length)};let l=ln(n.doc,o.head);return!l||/\s/.test(l)||i.indexOf(l)>-1?{changes:{insert:e+t,from:o.head},effects:Le.of(o.head+e.length),range:x.cursor(o.head+e.length)}:{range:r=o}});return r?null:n.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function Zc(n,e,t){let i=null,r=n.changeByRange(s=>s.empty&&ln(n.doc,s.head)==t?{changes:{from:s.head,to:s.head+t.length,insert:t},range:x.cursor(s.head+t.length)}:i={range:s});return i?null:n.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function Yc(n,e,t,i){let r=i.stringPrefixes||ut.stringPrefixes,s=null,o=n.changeByRange(l=>{if(!l.empty)return{changes:[{insert:e,from:l.from},{insert:e,from:l.to}],effects:Le.of(l.to+e.length),range:x.range(l.anchor+e.length,l.head+e.length)};let a=l.head,c=ln(n.doc,a),f;if(c==e){if(Gi(n,a))return{changes:{insert:e+e,from:a},effects:Le.of(a+e.length),range:x.cursor(a+e.length)};if(Ds(n,a)){let u=t&&n.sliceDoc(a,a+e.length*3)==e+e+e?e+e+e:e;return{changes:{from:a,to:a+u.length,insert:u},range:x.cursor(a+u.length)}}}else{if(t&&n.sliceDoc(a-2*e.length,a)==e+e&&(f=Ji(n,a-2*e.length,r))>-1&&Gi(n,f))return{changes:{insert:e+e+e+e,from:a},effects:Le.of(a+e.length),range:x.cursor(a+e.length)};if(n.charCategorizer(a)(c)!=K.Word&&Ji(n,a,r)>-1&&!Xc(n,a,e,r))return{changes:{insert:e+e,from:a},effects:Le.of(a+e.length),range:x.cursor(a+e.length)}}return{range:s=l}});return s?null:n.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function Gi(n,e){let t=U(n).resolveInner(e+1);return t.parent&&t.from==e}function Xc(n,e,t,i){let r=U(n).resolveInner(e,-1),s=i.reduce((o,l)=>Math.max(o,l.length),0);for(let o=0;o<5;o++){let l=n.sliceDoc(r.from,Math.min(r.to,r.from+t.length+s)),a=l.indexOf(t);if(!a||a>-1&&i.indexOf(l.slice(0,a))>-1){let f=r.firstChild;for(;f&&f.from==r.from&&f.to-f.from>t.length+a;){if(n.sliceDoc(f.to-t.length,f.to)==t)return!1;f=f.firstChild}return!0}let c=r.to==e&&r.parent;if(!c)break;r=c}return!1}function Ji(n,e,t){let i=n.charCategorizer(e);if(i(n.sliceDoc(e-1,e))!=K.Word)return e;for(let r of t){let s=e-r.length;if(n.sliceDoc(s,e)==r&&i(n.sliceDoc(s-1,s))!=K.Word)return s}return-1}function ef(n={}){return[Bc,J,_.of(n),Pc,tf,As]}const Bs=[{key:"Ctrl-Space",run:Vi},{mac:"Alt-`",run:Vi},{key:"Escape",run:Ac},{key:"ArrowDown",run:Pt(!0)},{key:"ArrowUp",run:Pt(!1)},{key:"PageDown",run:Pt(!0,"page")},{key:"PageUp",run:Pt(!1,"page")},{key:"Enter",run:Cc}],tf=mt.highest(Zt.computeN([_],n=>n.facet(_).defaultKeymap?[Bs]:[]));class Qi{constructor(e,t,i){this.from=e,this.to=t,this.diagnostic=i}}class De{constructor(e,t,i){this.diagnostics=e,this.panel=t,this.selected=i}static init(e,t,i){let r=i.facet(dt).markerFilter;r&&(e=r(e,i));let s=e.slice().sort((f,h)=>f.from-h.from||f.to-h.to),o=new Gt,l=[],a=0;for(let f=0;;){let h=f==s.length?null:s[f];if(!h&&!l.length)break;let u,d;for(l.length?(u=a,d=l.reduce((g,C)=>Math.min(g,C.to),h&&h.from>u?h.from:1e8)):(u=h.from,d=h.to,l.push(h),f++);f<s.length;){let g=s[f];if(g.from==u&&(g.to>g.from||g.to==u))l.push(g),f++,d=Math.min(g.to,d);else{d=Math.min(g.from,d);break}}let y=mf(l);if(l.some(g=>g.from==g.to||g.from==g.to-1&&i.doc.lineAt(g.from).to==g.from))o.add(u,u,A.widget({widget:new hf(y),diagnostics:l.slice()}));else{let g=l.reduce((C,P)=>P.markClass?C+" "+P.markClass:C,"");o.add(u,d,A.mark({class:"cm-lintRange cm-lintRange-"+y+g,diagnostics:l.slice(),inclusiveEnd:l.some(C=>C.to>d)}))}a=d;for(let g=0;g<l.length;g++)l[g].to<=a&&l.splice(g--,1)}let c=o.finish();return new De(c,t,Ge(c))}}function Ge(n,e=null,t=0){let i=null;return n.between(t,1e9,(r,s,{spec:o})=>{if(!(e&&o.diagnostics.indexOf(e)<0))if(!i)i=new Qi(r,s,e||o.diagnostics[0]);else{if(o.diagnostics.indexOf(i.diagnostic)<0)return!1;i=new Qi(i.from,s,i.diagnostic)}}),i}function nf(n,e){let t=e.pos,i=e.end||t,r=n.state.facet(dt).hideOn(n,t,i);if(r!=null)return r;let s=n.startState.doc.lineAt(e.pos);return!!(n.effects.some(o=>o.is(Ls))||n.changes.touchesRange(s.from,Math.max(s.to,i)))}function rf(n,e){return n.field(Y,!1)?e:e.concat(F.appendConfig.of(gf))}const Ls=F.define(),si=F.define(),Os=F.define(),Y=me.define({create(){return new De(A.none,null,null)},update(n,e){if(e.docChanged&&n.diagnostics.size){let t=n.diagnostics.map(e.changes),i=null,r=n.panel;if(n.selected){let s=e.changes.mapPos(n.selected.from,1);i=Ge(t,n.selected.diagnostic,s)||Ge(t,null,s)}!t.size&&r&&e.state.facet(dt).autoPanel&&(r=null),n=new De(t,r,i)}for(let t of e.effects)if(t.is(Ls)){let i=e.state.facet(dt).autoPanel?t.value.length?pt.open:null:n.panel;n=De.init(t.value,i,e.state)}else t.is(si)?n=new De(n.diagnostics,t.value?pt.open:null,n.selected):t.is(Os)&&(n=new De(n.diagnostics,n.panel,t.value));return n},provide:n=>[Nn.from(n,e=>e.panel),T.decorations.from(n,e=>e.diagnostics)]}),sf=A.mark({class:"cm-lintRange cm-lintRange-active"});function of(n,e,t){let{diagnostics:i}=n.state.field(Y),r,s=-1,o=-1;i.between(e-(t<0?1:0),e+(t>0?1:0),(a,c,{spec:f})=>{if(e>=a&&e<=c&&(a==c||(e>a||t>0)&&(e<c||t<0)))return r=f.diagnostics,s=a,o=c,!1});let l=n.state.facet(dt).tooltipFilter;return r&&l&&(r=l(r,n.state)),r?{pos:s,end:o,above:n.state.doc.lineAt(s).to<o,create(){return{dom:lf(n,r)}}}:null}function lf(n,e){return B("ul",{class:"cm-tooltip-lint"},e.map(t=>Ns(n,t,!1)))}const af=n=>{let e=n.state.field(Y,!1);(!e||!e.panel)&&n.dispatch({effects:rf(n.state,[si.of(!0)])});let t=rt(n,pt.open);return t&&t.dom.querySelector(".cm-panel-lint ul").focus(),!0},Zi=n=>{let e=n.state.field(Y,!1);return!e||!e.panel?!1:(n.dispatch({effects:si.of(!1)}),!0)},cf=n=>{let e=n.state.field(Y,!1);if(!e)return!1;let t=n.state.selection.main,i=e.diagnostics.iter(t.to+1);return!i.value&&(i=e.diagnostics.iter(0),!i.value||i.from==t.from&&i.to==t.to)?!1:(n.dispatch({selection:{anchor:i.from,head:i.to},scrollIntoView:!0}),!0)},ff=[{key:"Mod-Shift-m",run:af,preventDefault:!0},{key:"F8",run:cf}],dt=H.define({combine(n){return Object.assign({sources:n.map(e=>e.source).filter(e=>e!=null)},We(n.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null,hideOn:()=>null},{needsRefresh:(e,t)=>e?t?i=>e(i)||t(i):e:t}))}});function Es(n){let e=[];if(n)e:for(let{name:t}of n){for(let i=0;i<t.length;i++){let r=t[i];if(/[a-zA-Z]/.test(r)&&!e.some(s=>s.toLowerCase()==r.toLowerCase())){e.push(r);continue e}}e.push("")}return e}function Ns(n,e,t){var i;let r=t?Es(e.actions):[];return B("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},B("span",{class:"cm-diagnosticText"},e.renderMessage?e.renderMessage(n):e.message),(i=e.actions)===null||i===void 0?void 0:i.map((s,o)=>{let l=!1,a=u=>{if(u.preventDefault(),l)return;l=!0;let d=Ge(n.state.field(Y).diagnostics,e);d&&s.apply(n,d.from,d.to)},{name:c}=s,f=r[o]?c.indexOf(r[o]):-1,h=f<0?c:[c.slice(0,f),B("u",c.slice(f,f+1)),c.slice(f+1)];return B("button",{type:"button",class:"cm-diagnosticAction",onclick:a,onmousedown:a,"aria-label":` Action: ${c}${f<0?"":` (access key "${r[o]})"`}.`},h)}),e.source&&B("div",{class:"cm-diagnosticSource"},e.source))}class hf extends Qt{constructor(e){super(),this.sev=e}eq(e){return e.sev==this.sev}toDOM(){return B("span",{class:"cm-lintPoint cm-lintPoint-"+this.sev})}}class Yi{constructor(e,t){this.diagnostic=t,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=Ns(e,t,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class pt{constructor(e){this.view=e,this.items=[];let t=r=>{if(r.keyCode==27)Zi(this.view),this.view.focus();else if(r.keyCode==38||r.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(r.keyCode==40||r.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(r.keyCode==36)this.moveSelection(0);else if(r.keyCode==35)this.moveSelection(this.items.length-1);else if(r.keyCode==13)this.view.focus();else if(r.keyCode>=65&&r.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:s}=this.items[this.selectedIndex],o=Es(s.actions);for(let l=0;l<o.length;l++)if(o[l].toUpperCase().charCodeAt(0)==r.keyCode){let a=Ge(this.view.state.field(Y).diagnostics,s);a&&s.actions[l].apply(e,a.from,a.to)}}else return;r.preventDefault()},i=r=>{for(let s=0;s<this.items.length;s++)this.items[s].dom.contains(r.target)&&this.moveSelection(s)};this.list=B("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:t,onclick:i}),this.dom=B("div",{class:"cm-panel-lint"},this.list,B("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>Zi(this.view)},"×")),this.update()}get selectedIndex(){let e=this.view.state.field(Y).selected;if(!e)return-1;for(let t=0;t<this.items.length;t++)if(this.items[t].diagnostic==e.diagnostic)return t;return-1}update(){let{diagnostics:e,selected:t}=this.view.state.field(Y),i=0,r=!1,s=null,o=new Set;for(e.between(0,this.view.state.doc.length,(l,a,{spec:c})=>{for(let f of c.diagnostics){if(o.has(f))continue;o.add(f);let h=-1,u;for(let d=i;d<this.items.length;d++)if(this.items[d].diagnostic==f){h=d;break}h<0?(u=new Yi(this.view,f),this.items.splice(i,0,u),r=!0):(u=this.items[h],h>i&&(this.items.splice(i,h-i),r=!0)),t&&u.diagnostic==t.diagnostic?u.dom.hasAttribute("aria-selected")||(u.dom.setAttribute("aria-selected","true"),s=u):u.dom.hasAttribute("aria-selected")&&u.dom.removeAttribute("aria-selected"),i++}});i<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)r=!0,this.items.pop();this.items.length==0&&(this.items.push(new Yi(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),r=!0),s?(this.list.setAttribute("aria-activedescendant",s.id),this.view.requestMeasure({key:this,read:()=>({sel:s.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:l,panel:a})=>{let c=a.height/this.list.offsetHeight;l.top<a.top?this.list.scrollTop-=(a.top-l.top)/c:l.bottom>a.bottom&&(this.list.scrollTop+=(l.bottom-a.bottom)/c)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),r&&this.sync()}sync(){let e=this.list.firstChild;function t(){let i=e;e=i.nextSibling,i.remove()}for(let i of this.items)if(i.dom.parentNode==this.list){for(;e!=i.dom;)t();e=i.dom.nextSibling}else this.list.insertBefore(i.dom,e);for(;e;)t()}moveSelection(e){if(this.selectedIndex<0)return;let t=this.view.state.field(Y),i=Ge(t.diagnostics,this.items[e].diagnostic);i&&this.view.dispatch({selection:{anchor:i.from,head:i.to},scrollIntoView:!0,effects:Os.of(i)})}static open(e){return new pt(e)}}function uf(n,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(n)}</svg>')`}function Dt(n){return uf(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${n}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const df=T.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:Dt("#d11")},".cm-lintRange-warning":{backgroundImage:Dt("orange")},".cm-lintRange-info":{backgroundImage:Dt("#999")},".cm-lintRange-hint":{backgroundImage:Dt("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});function pf(n){return n=="error"?4:n=="warning"?3:n=="info"?2:1}function mf(n){let e="hint",t=1;for(let i of n){let r=pf(i.severity);r>t&&(t=r,e=i.severity)}return e}const gf=[Y,T.decorations.compute([Y],n=>{let{selected:e,panel:t}=n.field(Y);return!e||!t||e.from==e.to?A.none:A.set([sf.range(e.from,e.to)])}),Us(of,{hideOn:nf}),df],yf=[js(),Hs(),Vs(),Bl(),Xo(),Ks(),Gs(),Oe.allowMultipleSelections.of(!0),qo(),tl(rl,{fallback:!0}),hl(),Uc(),ef(),Js(),Qs(),Zs(),Fa(),Zt.of([...Kc,...fs,...nc,...zl,...Jo,...Bs,...ff])],bf=tr`
  <svg
    xmlns="http://www.w3.org/2000/svg"
    height="24px"
    viewBox="0 -960 960 960"
    width="24px"
  >
    <path
      d="m644-428-58-58q9-47-27-88t-93-32l-58-58q17-8 34.5-12t37.5-4q75 0 127.5 52.5T660-500q0 20-4 37.5T644-428Zm128 126-58-56q38-29 67.5-63.5T832-500q-50-101-143.5-160.5T480-720q-29 0-57 4t-55 12l-62-62q41-17 84-25.5t90-8.5q151 0 269 83.5T920-500q-23 59-60.5 109.5T772-302Zm20 246L624-222q-35 11-70.5 16.5T480-200q-151 0-269-83.5T40-500q21-53 53-98.5t73-81.5L56-792l56-56 736 736-56 56ZM222-624q-29 26-53 57t-41 67q50 101 143.5 160.5T480-280q20 0 39-2.5t39-5.5l-36-38q-11 3-21 4.5t-21 1.5q-75 0-127.5-52.5T300-500q0-11 1.5-21t4.5-21l-84-82Zm319 93Zm-151 75Z"
    />
  </svg>
`,xf=(n,e={})=>{n.config(async t=>{let{languages:i,theme:r}=e;if(!i){const{languages:s}=await ai(async()=>{const{languages:o}=await import("./index-CVB99Otp.js");return{languages:o}},__vite__mapDeps([0,1,2,3,4,5,6]));i=s}if(!r){const{oneDark:s}=await ai(async()=>{const{oneDark:o}=await import("./index-w3KOZPBS.js");return{oneDark:o}},__vite__mapDeps([7,3,1,2,4,5,6]));r=s}t.update(Ys.key,s=>{var o;return{extensions:[Zt.of(fs.concat(Ba)),yf,r,...(o=e==null?void 0:e.extensions)!=null?o:[]],languages:i,expandIcon:e.expandIcon||(()=>no),searchIcon:e.searchIcon||(()=>to),clearSearchIcon:e.clearSearchIcon||(()=>eo),searchPlaceholder:e.searchPlaceholder||"Search language",noResultText:e.noResultText||"No result",renderLanguage:e.renderLanguage||s.renderLanguage,renderPreview:e.renderPreview||s.renderPreview,previewToggleButton:l=>{var a,c;return tr`
            ${((a=e.previewToggleIcon)==null?void 0:a.call(e,l))||(l?io:bf)}
            ${((c=e.previewToggleText)==null?void 0:c.call(e,l))||(l?"Edit":"Hide")}
          `},previewLabel:e.previewLabel||s.previewLabel}})}).use(Xs)},Of=Object.freeze(Object.defineProperty({__proto__:null,defineFeature:xf},Symbol.toStringTag,{value:"Module"}));export{ul as A,Io as B,ws as C,ro as D,Of as E,tn as H,R as I,fr as L,Sf as N,sr as P,Mr as S,te as T,Mf as a,Sn as b,So as c,Pf as d,Bf as e,_o as f,lc as g,U as h,hr as i,Tf as j,If as k,Df as l,Lf as m,G as n,S as o,Cf as p,Fn as q,O as r,tl as s,m as t,ie as u,ar as v,zo as w,Yt as x,Be as y,He as z};
